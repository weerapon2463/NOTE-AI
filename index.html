<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NoteAI â€” à¸šà¸±à¸™à¸—à¸¶à¸ Â· à¸ªà¸£à¸¸à¸› Â· à¹à¸›à¸¥</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#07090f;--s1:#0d1018;--s2:#131720;--s3:#1a2030;
  --border:rgba(80,120,200,0.1);--border2:rgba(80,120,200,0.18);
  --blue:#4f8ef7;--cyan:#22d3ee;--green:#22c55e;
  --amber:#f59e0b;--rose:#f43f5e;--violet:#a78bfa;
  --text:#eef2ff;--text2:#7c88aa;--text3:#3a4255;--rec:#ef4444;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:'Sarabun','Inter',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 60% 40% at 15% 15%,rgba(79,142,247,.07),transparent 60%),radial-gradient(ellipse 50% 50% at 85% 85%,rgba(167,139,250,.05),transparent 60%);pointer-events:none;z-index:0;}
.app{position:relative;z-index:1;max-width:440px;margin:0 auto;min-height:100vh;padding-bottom:90px;}

/* â”€â”€ HEADER â”€â”€ */
.header{padding:48px 20px 10px;display:flex;align-items:center;justify-content:space-between;}
.logo{display:flex;align-items:center;gap:10px;}
.logo-mark{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--cyan));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 16px rgba(79,142,247,.3);}
.logo-text{font-size:20px;font-weight:700;letter-spacing:-.5px;background:linear-gradient(90deg,#fff,#a5c0f0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.logo-sub{font-size:10px;color:var(--text2);margin-top:1px;}
.hdr-r{display:flex;gap:7px;}
.icon-btn{width:36px;height:36px;border-radius:10px;background:var(--s2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:15px;transition:all .2s;}
.icon-btn:active{transform:scale(.92);}

/* â”€â”€ PAGES / ANIM â”€â”€ */
.page{display:none;}
.page.active{display:block;animation:fadeUp .25s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(7px);}to{opacity:1;transform:translateY(0);}}

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:440px;background:rgba(7,9,15,.94);backdrop-filter:blur(20px);border-top:1px solid var(--border);display:flex;padding:8px 0 22px;z-index:100;}
.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:5px;background:none;border:none;color:var(--text2);font-family:inherit;transition:color .2s;}
.bnav-item.active{color:var(--blue);}
.bnav-ic{font-size:20px;}
.bnav-lbl{font-size:10px;font-weight:600;}

/* â”€â”€ DEMO BANNER â”€â”€ */
.demo-banner{margin:0 20px 10px;padding:10px 14px;background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.2);border-radius:10px;font-size:12px;color:#fbbf24;display:none;}
.demo-banner.show{display:block;}

/* â”€â”€ MODE BAR â”€â”€ */
.mode-bar{margin:0 20px 12px;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:5px;display:flex;gap:4px;}
.modebt{flex:1;padding:8px 3px;border-radius:10px;border:none;background:none;color:var(--text2);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;text-align:center;line-height:1.4;}
.modebt.active{background:var(--blue);color:#fff;box-shadow:0 2px 8px rgba(79,142,247,.35);}

/* â”€â”€ REC HERO â”€â”€ */
.rec-hero{margin:0 20px 12px;background:var(--s1);border:1px solid var(--border);border-radius:22px;padding:22px 20px;display:flex;flex-direction:column;align-items:center;gap:12px;position:relative;overflow:hidden;}
.rec-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(79,142,247,.07),transparent 70%);pointer-events:none;}
.orb-wrap{position:relative;width:126px;height:126px;display:flex;align-items:center;justify-content:center;}
.orb-ring{position:absolute;border-radius:50%;border:1.5px solid rgba(79,142,247,.12);animation:orb 4s ease-in-out infinite;}
.orb-ring:nth-child(1){width:100%;height:100%;}
.orb-ring:nth-child(2){width:72%;height:72%;animation-delay:.7s;border-color:rgba(34,211,238,.12);}
.orb-ring:nth-child(3){width:46%;height:46%;animation-delay:1.4s;border-color:rgba(167,139,250,.12);}
@keyframes orb{0%,100%{transform:scale(1);opacity:.4;}50%{transform:scale(1.04);opacity:1;}}
.rec-btn{position:relative;z-index:2;width:68px;height:68px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--blue),var(--cyan));cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:25px;transition:all .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 6px 20px rgba(79,142,247,.35);}
.rec-btn:active{transform:scale(.88);}
.rec-btn.rec{background:linear-gradient(135deg,var(--rec),#ff6b6b);box-shadow:0 6px 20px rgba(239,68,68,.4);animation:throb 1.5s ease-in-out infinite;}
@keyframes throb{0%,100%{box-shadow:0 6px 20px rgba(239,68,68,.4),0 0 0 0 rgba(239,68,68,.2);}50%{box-shadow:0 6px 20px rgba(239,68,68,.4),0 0 0 14px rgba(239,68,68,0);}}
.rec-label{font-size:13px;font-weight:600;text-align:center;}
.rec-timer{font-size:11px;color:var(--text2);letter-spacing:2px;font-variant-numeric:tabular-nums;}
.rec-timer.live{color:var(--rec);}
.waveform{display:flex;align-items:center;gap:2px;height:26px;opacity:0;transition:opacity .3s;}
.waveform.show{opacity:1;}
.wbar{width:3px;background:linear-gradient(180deg,var(--blue),var(--cyan));border-radius:2px;animation:wv .9s ease-in-out infinite;}
@keyframes wv{0%,100%{height:3px;}50%{height:20px;}}

/* â”€â”€ LIVE TRANSCRIPT BOX â”€â”€ */
.live-box{margin:0 20px 10px;background:var(--s1);border:1px solid var(--border2);border-radius:13px;padding:12px 14px;display:none;max-height:140px;overflow-y:auto;}
.live-box.show{display:block;animation:fadeUp .3s ease;}
.lt-hdr{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--rec);margin-bottom:7px;display:flex;align-items:center;gap:5px;}
.lt-dot{width:6px;height:6px;border-radius:50%;background:var(--rec);animation:blink2 1s step-end infinite;}
@keyframes blink2{0%,100%{opacity:1;}50%{opacity:.2;}}
.lt-text{font-size:13px;line-height:1.7;font-weight:300;}
.cursor{display:inline-block;width:2px;height:13px;background:var(--blue);margin-left:2px;vertical-align:middle;animation:blink .8s step-end infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0;}}

/* â”€â”€ UPLOAD / FILE â”€â”€ */
.upload-zone{margin:0 20px 10px;border:2px dashed var(--border2);border-radius:15px;padding:18px;text-align:center;cursor:pointer;transition:all .2s;background:rgba(79,142,247,.02);}
.upload-zone:active,.upload-zone.over{background:rgba(79,142,247,.07);border-color:var(--blue);}
.upload-zone .ui{font-size:26px;margin-bottom:5px;}
.upload-zone .ut{font-size:13px;font-weight:600;}
.upload-zone .us{font-size:11px;color:var(--text2);margin-top:2px;}
.fmt-row{display:flex;gap:4px;justify-content:center;margin-top:7px;flex-wrap:wrap;}
.fmt{background:var(--s2);border:1px solid var(--border2);border-radius:5px;padding:2px 7px;font-size:10px;color:var(--text2);}
.file-prev{margin:0 20px 10px;background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:12px 14px;display:none;flex-direction:column;gap:9px;}
.file-prev.show{display:flex;animation:fadeUp .3s ease;}
.file-info-row{display:flex;align-items:center;gap:10px;}
.file-ic{width:36px;height:36px;border-radius:9px;background:rgba(79,142,247,.1);border:1px solid rgba(79,142,247,.2);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.file-name{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.file-size{font-size:11px;color:var(--text2);margin-top:1px;}
.file-btns{display:flex;gap:7px;}
.fa-btn{flex:1;padding:9px;border-radius:9px;border:none;font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;}
.fa-btn.pri{background:linear-gradient(135deg,var(--blue),var(--cyan));color:#fff;}
.fa-btn.sec{background:var(--s2);border:1px solid var(--border2);color:var(--text2);}
.fa-btn:active{transform:scale(.96);}

/* â”€â”€ YOUTUBE/TEXT ZONE â”€â”€ */
.yt-zone{margin:0 20px 10px;background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:14px;display:none;}
.yt-zone.show{display:block;animation:fadeUp .3s ease;}
.yt-title{font-size:13px;font-weight:700;margin-bottom:10px;}
.yt-tabs{display:flex;gap:5px;margin-bottom:10px;}
.yt-tab{padding:5px 12px;border-radius:7px;border:1px solid var(--border2);background:var(--s2);color:var(--text2);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.yt-tab.active{background:rgba(79,142,247,.12);border-color:var(--blue);color:var(--blue);}
.yt-inp{width:100%;background:var(--s2);border:1.5px solid var(--border2);border-radius:9px;padding:10px 12px;color:var(--text);font-family:inherit;font-size:13px;outline:none;transition:border-color .2s;resize:none;}
.yt-inp:focus{border-color:var(--blue);}
.yt-btn{width:100%;margin-top:8px;padding:11px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--cyan));border:none;color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;}
.yt-btn:active{opacity:.85;}
.yt-note{font-size:11px;color:var(--text2);margin-top:7px;line-height:1.6;}

/* â”€â”€ TRANSLATE BAR â”€â”€ */
.tl-bar{margin:0 20px 10px;background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:12px 14px;display:none;}
.tl-bar.show{display:block;animation:fadeUp .3s ease;}
.tl-hdr{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--violet);margin-bottom:8px;}
.lang-row{display:flex;align-items:center;gap:7px;flex-wrap:wrap;}
.lang-sel{flex:1;min-width:0;background:var(--s2);border:1px solid var(--border2);border-radius:9px;padding:7px 9px;color:var(--text);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;outline:none;}
.swap-ic{color:var(--text3);font-size:17px;cursor:pointer;flex-shrink:0;transition:transform .3s;}
.swap-ic:active{transform:rotate(180deg);}

/* â”€â”€ PROCESSING â”€â”€ */
.proc-card{margin:0 20px 10px;background:var(--s1);border:1px solid var(--border);border-radius:15px;padding:15px;display:none;}
.proc-card.show{display:block;animation:fadeUp .3s ease;}
.proc-title{font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:11px;}
.psteps{display:flex;flex-direction:column;gap:8px;}
.pstep{display:flex;align-items:center;gap:10px;opacity:.2;transition:all .4s;}
.pstep.active{opacity:1;}
.pstep.done{opacity:.45;}
.pstep-ic{width:30px;height:30px;border-radius:9px;background:var(--s2);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;}
.pstep.active .pstep-ic{border-color:var(--blue);background:rgba(79,142,247,.1);animation:gpulse 1.2s ease-in-out infinite;}
.pstep.done .pstep-ic{border-color:var(--green);}
@keyframes gpulse{0%,100%{box-shadow:0 0 0 0 rgba(79,142,247,.4);}50%{box-shadow:0 0 0 5px rgba(79,142,247,0);}}
.pstep-name{font-size:13px;font-weight:600;}
.pstep-desc{font-size:10px;color:var(--text2);margin-top:1px;}

/* â”€â”€ RESULT WRAP â”€â”€ */
.result-wrap{margin:0 20px;display:none;}
.result-wrap.show{display:block;animation:fadeUp .3s ease;}
.result-head{background:var(--s1);border:1px solid var(--border);border-radius:15px 15px 0 0;padding:11px 15px;display:flex;align-items:center;justify-content:space-between;}
.result-title{font-size:13px;font-weight:700;}
.result-chips{display:flex;gap:5px;flex-wrap:wrap;}
.chip{background:var(--s2);border:1px solid var(--border2);border-radius:7px;padding:3px 8px;font-size:11px;color:var(--text2);}
.chip.vio{background:rgba(167,139,250,.1);border-color:var(--violet);color:var(--violet);}
.report-scroll{background:var(--s1);border-left:1px solid var(--border);border-right:1px solid var(--border);padding:7px 11px;display:flex;gap:5px;overflow-x:auto;scrollbar-width:none;}
.report-scroll::-webkit-scrollbar{display:none;}
.rtype{flex-shrink:0;padding:5px 11px;border-radius:18px;background:var(--s2);border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:10px;font-weight:500;cursor:pointer;transition:all .2s;}
.rtype.active{background:rgba(79,142,247,.12);border-color:var(--blue);color:var(--blue);}
.ctabs{background:var(--s1);border-left:1px solid var(--border);border-right:1px solid var(--border);border-bottom:1px solid var(--border);display:flex;}
.ctab{flex:1;padding:9px 2px;background:none;border:none;color:var(--text2);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;position:relative;}
.ctab.active{color:var(--text);}
.ctab.active::after{content:'';position:absolute;bottom:0;left:12%;right:12%;height:2px;background:var(--blue);border-radius:2px;}
.result-body{background:var(--s1);border:1px solid var(--border);border-top:none;border-radius:0 0 15px 15px;min-height:140px;}
.tab-pane{padding:15px;display:none;}
.tab-pane.active{display:block;}

/* Transcript */
.trs-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.trs-note{font-size:10px;color:var(--text2);}
.lang-toggle{display:flex;background:var(--s2);border:1px solid var(--border2);border-radius:8px;overflow:hidden;}
.ltb{padding:4px 9px;border:none;background:none;color:var(--text2);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;}
.ltb.active{background:var(--violet);color:#fff;}
.spk-block{margin-bottom:13px;}
.spk-label{display:inline-flex;align-items:center;gap:5px;background:var(--s2);border:1px solid var(--border2);border-radius:7px;padding:3px 9px;font-size:11px;font-weight:600;margin-bottom:5px;cursor:pointer;transition:all .2s;}
.spk-label:active{border-color:var(--blue);}
.spk-dot{width:7px;height:7px;border-radius:50%;}
.spk-text{font-size:13px;line-height:1.8;font-weight:300;margin-bottom:2px;}
.spk-text-tr{font-size:12px;line-height:1.7;font-weight:300;color:var(--violet);font-style:italic;margin-bottom:3px;display:none;}
.spk-text-tr.show{display:block;}

/* Summary */
.detail-selector{display:flex;gap:4px;margin-bottom:11px;background:var(--s2);border-radius:10px;padding:4px;}
.dl-btn{flex:1;padding:5px;border-radius:7px;border:none;background:none;color:var(--text2);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.dl-btn.active{background:var(--blue);color:#fff;}
.sum-block{margin-bottom:13px;}
.sum-lbl{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--blue);margin-bottom:6px;}
.sum-text{font-size:13px;line-height:1.8;font-weight:300;}
.sum-pt{display:flex;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px;}
.sum-pt:last-child{border-bottom:none;}

/* Actions */
.action-list{list-style:none;}
.action-row{display:flex;align-items:flex-start;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);}
.action-row:last-child{border-bottom:none;}
.acb{width:20px;height:20px;border-radius:6px;border:1.5px solid var(--border2);flex-shrink:0;margin-top:2px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;transition:all .2s;}
.acb.done{background:var(--green);border-color:var(--green);color:#fff;}
.ac-content{flex:1;}
.ac-txt{font-size:13px;line-height:1.6;font-weight:600;}
.ac-txt.done{text-decoration:line-through;color:var(--text2);}
.ac-meta{display:flex;gap:5px;margin-top:3px;flex-wrap:wrap;}
.ac-who{background:var(--s2);border:1px solid var(--border2);border-radius:5px;padding:2px 7px;font-size:10px;color:var(--text2);}
.pri-h{background:rgba(244,63,94,.1);color:var(--rose);border:1px solid rgba(244,63,94,.2);border-radius:5px;padding:2px 7px;font-size:10px;font-weight:700;}
.pri-m{background:rgba(245,158,11,.1);color:var(--amber);border:1px solid rgba(245,158,11,.2);border-radius:5px;padding:2px 7px;font-size:10px;font-weight:700;}
.pri-l{background:rgba(34,197,94,.1);color:var(--green);border:1px solid rgba(34,197,94,.2);border-radius:5px;padding:2px 7px;font-size:10px;font-weight:700;}
.sub-toggle{font-size:10px;color:var(--text3);cursor:pointer;padding:2px 7px;border-radius:5px;background:var(--s2);border:1px solid var(--border);margin-top:4px;display:inline-block;}
.sub-list{margin-top:5px;display:flex;flex-direction:column;gap:3px;}
.sub-row{display:flex;align-items:center;gap:7px;padding:2px 0;}
.scb{width:15px;height:15px;border-radius:4px;border:1.5px solid var(--border2);flex-shrink:0;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:9px;}
.scb.done{background:var(--green);border-color:var(--green);color:#fff;}
.s-txt{font-size:11px;color:var(--text2);}
.s-txt.done{text-decoration:line-through;color:var(--text3);}

/* Mind Map */
.mm-pane{padding:0;background:#fff;border-radius:0 0 15px 15px;overflow:hidden;min-height:290px;position:relative;}
.mm-toolbar{padding:8px 12px;background:var(--s1);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.mm-tl-lbl{font-size:10px;font-weight:600;color:var(--text2);}
.mm-ctrls{display:flex;gap:4px;}
.mc{width:26px;height:26px;border-radius:7px;background:var(--s2);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;color:var(--text2);transition:all .2s;}
.mc.w{width:auto;padding:0 7px;font-size:10px;}
.mc:active{background:var(--s3);}
.mm-canvas{width:100%;height:280px;background:#fafafa;overflow:hidden;cursor:grab;user-select:none;position:relative;}
.mm-canvas.grabbing{cursor:grabbing;}
.mm-canvas svg{position:absolute;top:0;left:0;overflow:visible;}

/* Export */
.export-row{padding:11px 15px;display:flex;gap:6px;flex-wrap:wrap;}
.exp-btn{flex:1;min-width:calc(50% - 4px);padding:8px;border-radius:10px;background:var(--s2);border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .2s;}
.exp-btn:active{transform:scale(.95);}

/* â”€â”€ TRANSLATE PAGE â”€â”€ */
#page-translate{padding:0 20px;}
.tl-page-hdr{padding:16px 20px 8px;font-size:11px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;}
.lang-pair-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.lp-sel{flex:1;background:var(--s2);border:1.5px solid var(--border2);border-radius:11px;padding:10px 12px;color:var(--text);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;outline:none;transition:border-color .2s;}
.lp-sel:focus{border-color:var(--blue);}
.lp-swap{width:36px;height:36px;border-radius:50%;background:var(--s2);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:17px;cursor:pointer;flex-shrink:0;transition:transform .3s;}
.lp-swap:active{transform:rotate(180deg) scale(.9);}
.tl-rec-card{background:var(--s1);border:1px solid var(--border);border-radius:18px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:11px;position:relative;overflow:hidden;}
.tl-rec-card::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(167,139,250,.06),transparent 70%);pointer-events:none;}
.tl-rec-btn{width:64px;height:64px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--violet),#c084fc);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:24px;transition:all .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 5px 18px rgba(167,139,250,.35);}
.tl-rec-btn:active{transform:scale(.88);}
.tl-rec-btn.rec{background:linear-gradient(135deg,var(--rec),#ff6b6b);animation:throb 1.4s ease-in-out infinite;}
.tl-rec-hint{font-size:12px;font-weight:600;color:var(--text2);text-align:center;}
.tl-timer{font-size:11px;color:var(--rec);letter-spacing:2px;display:none;}
.tl-timer.show{display:block;}
.tl-wv{display:flex;align-items:center;gap:2px;height:20px;opacity:0;transition:opacity .3s;}
.tl-wv.show{opacity:1;}
.tl-wvb{width:3px;background:linear-gradient(180deg,var(--violet),#c084fc);border-radius:2px;animation:wv .8s ease-in-out infinite;}
.tl-result{background:var(--s1);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:10px;display:none;}
.tl-result.show{display:block;animation:fadeUp .3s ease;}
.tl-lang-bar{padding:8px 13px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:7px;font-size:11px;}
.tl-badge{padding:3px 8px;border-radius:6px;font-size:10px;font-weight:700;}
.tl-badge.orig{background:rgba(79,142,247,.12);color:var(--blue);}
.tl-badge.trans{background:rgba(167,139,250,.12);color:var(--violet);}
.tl-sec{padding:11px 13px;border-bottom:1px solid var(--border);}
.tl-sec:last-child{border-bottom:none;}
.tl-sec-text{font-size:14px;line-height:1.8;}
.tl-sec-text.orig{color:var(--text);}
.tl-sec-text.trans{color:var(--violet);}
.tl-actions{display:flex;gap:6px;padding:9px 13px;flex-wrap:wrap;}
.tl-act-btn{padding:6px 12px;border-radius:9px;background:var(--s2);border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .2s;}
.tl-act-btn:active{transform:scale(.95);}
.tl-act-btn.playing{background:rgba(34,197,94,.1);border-color:var(--green);color:var(--green);animation:pulse .8s ease-in-out infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.6;}}
.tl-hist-list{margin-top:4px;}
.tl-hist-title{font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:7px;}
.tl-hist-item{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:10px 12px;margin-bottom:7px;cursor:pointer;transition:all .2s;}
.tl-hist-item:active{background:var(--s2);}
.thi-orig{font-size:13px;font-weight:500;}
.thi-trans{font-size:12px;color:var(--violet);margin-top:2px;}
.thi-meta{font-size:10px;color:var(--text3);margin-top:3px;}

/* â”€â”€ CONVERSATION PAGE â”€â”€ */
#page-convo{padding:0 20px;}
.convo-hdr{display:flex;gap:9px;margin-bottom:11px;}
.pc{flex:1;background:var(--s1);border:1.5px solid var(--border);border-radius:13px;padding:11px 10px;text-align:center;cursor:pointer;transition:all .3s;}
.pc.active-a{border-color:var(--blue);background:rgba(79,142,247,.07);}
.pc.active-b{border-color:var(--violet);background:rgba(167,139,250,.07);}
.pc-av{font-size:26px;margin-bottom:4px;}
.pc-nm{font-size:11px;font-weight:700;}
.pc-lg{font-size:10px;color:var(--text2);margin-top:2px;}
.pc-lg select{background:none;border:none;color:var(--text2);font-family:inherit;font-size:10px;cursor:pointer;outline:none;}
.convo-feed{background:var(--s1);border:1px solid var(--border);border-radius:15px;padding:12px;min-height:180px;max-height:300px;overflow-y:auto;margin-bottom:11px;display:flex;flex-direction:column;gap:9px;}
.bubble{max-width:85%;padding:10px 12px;border-radius:13px;font-size:13px;line-height:1.7;}
.bubble.a{background:rgba(79,142,247,.1);border:1px solid rgba(79,142,247,.2);align-self:flex-start;border-bottom-left-radius:3px;}
.bubble.b{background:rgba(167,139,250,.1);border:1px solid rgba(167,139,250,.2);align-self:flex-end;border-bottom-right-radius:3px;}
.bub-orig{font-weight:500;}
.bub-trans{font-size:11px;margin-top:3px;opacity:.75;font-style:italic;}
.bub-trans.a{color:var(--blue);}
.bub-trans.b{color:var(--violet);}
.bub-meta{font-size:10px;opacity:.45;margin-top:4px;display:flex;align-items:center;gap:5px;}
.spk-mini{cursor:pointer;font-size:13px;}
.cv-empty{text-align:center;color:var(--text3);font-size:12px;padding:16px 0;line-height:1.7;}
.convo-btns{display:flex;gap:7px;margin-bottom:9px;}
.cv-btn{flex:1;padding:13px 8px;border-radius:13px;border:none;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:all .25s cubic-bezier(.34,1.56,.64,1);}
.cv-btn:active{transform:scale(.94);}
.cv-btn.a{background:linear-gradient(135deg,var(--blue),var(--cyan));color:#fff;box-shadow:0 4px 14px rgba(79,142,247,.3);}
.cv-btn.b{background:linear-gradient(135deg,var(--violet),#c084fc);color:#fff;box-shadow:0 4px 14px rgba(167,139,250,.3);}
.cv-btn.rec{animation:throb 1.2s ease-in-out infinite;}
.cv-btn-inner{display:flex;flex-direction:column;align-items:flex-start;}
.cv-btn-name{font-size:12px;}
.cv-btn-hint{font-size:10px;opacity:.75;font-weight:400;}
.convo-footer{display:flex;gap:6px;}
.cf-btn{flex:1;padding:8px;border-radius:10px;background:var(--s2);border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;}
.cf-btn:active{background:var(--s3);}
.cf-btn.red{border-color:rgba(244,63,94,.3);color:var(--rose);}

/* â”€â”€ HISTORY PAGE â”€â”€ */
.page-hdr{padding:16px 20px 8px;font-size:11px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;}
.hist-list{padding:0 20px;display:flex;flex-direction:column;gap:8px;}
.hist-item{background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:12px 13px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all .2s;}
.hist-item:active{transform:scale(.98);background:var(--s2);}
.hi-ic{width:38px;height:38px;border-radius:10px;background:var(--s2);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.hi-info{flex:1;min-width:0;}
.hi-title{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.hi-meta{display:flex;gap:6px;margin-top:2px;flex-wrap:wrap;}
.hi-tag{font-size:10px;color:var(--text2);}
.hi-arr{color:var(--text3);font-size:17px;}

/* â”€â”€ SETTINGS PAGE â”€â”€ */
.settings-body{padding:15px 20px;}
.set-sec{background:var(--s1);border:1px solid var(--border);border-radius:13px;padding:15px;margin-bottom:10px;}
.set-sec-title{font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:11px;}
.set-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);}
.set-row:last-child{border-bottom:none;}
.set-label{font-size:13px;font-weight:500;}
.set-sub{font-size:10px;color:var(--text2);margin-top:1px;}
.toggle{width:42px;height:24px;border-radius:12px;background:var(--s3);border:none;cursor:pointer;position:relative;transition:background .3s;}
.toggle.on{background:var(--blue);}
.toggle::after{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#fff;transition:transform .3s;}
.toggle.on::after{transform:translateX(18px);}
.inp{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:9px;padding:10px 12px;color:var(--text);font-family:inherit;font-size:13px;outline:none;margin-bottom:8px;transition:border-color .2s;}
.inp:focus{border-color:var(--blue);}
.btn-save{width:100%;padding:11px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--cyan));border:none;color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;}
.btn-save:active{opacity:.9;}
.sel-set{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:9px;padding:9px 11px;color:var(--text);font-family:inherit;font-size:12px;outline:none;margin-top:6px;}

/* â”€â”€ MODALS â”€â”€ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(12px);z-index:200;display:none;align-items:flex-end;padding:18px;}
.modal-bg.show{display:flex;animation:fadeUp .2s ease;}
.modal-box{background:var(--s2);border:1px solid var(--border2);border-radius:22px;padding:24px;width:100%;animation:slideUp .3s ease;}
@keyframes slideUp{from{transform:translateY(28px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.modal-title{font-size:17px;font-weight:700;margin-bottom:4px;}
.modal-sub{font-size:12px;color:var(--text2);line-height:1.6;margin-bottom:15px;}
.btn-pri{width:100%;padding:12px;border-radius:11px;background:linear-gradient(135deg,var(--blue),var(--cyan));border:none;color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;}
.btn-sec{width:100%;padding:11px;border-radius:11px;background:none;border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;margin-top:7px;}
.rename-modal{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(10px);z-index:300;display:none;align-items:flex-end;padding:18px;}
.rename-modal.show{display:flex;animation:fadeUp .2s ease;}
.rename-box{background:var(--s2);border:1px solid var(--border2);border-radius:20px;padding:22px;width:100%;animation:slideUp .25s ease;}
.rename-title{font-size:15px;font-weight:700;margin-bottom:3px;}
.rename-sub{font-size:11px;color:var(--text2);margin-bottom:13px;}
.rename-inp{width:100%;background:var(--s3);border:1.5px solid var(--border2);border-radius:10px;padding:11px 13px;color:var(--text);font-family:inherit;font-size:14px;font-weight:600;outline:none;transition:border-color .2s;}
.rename-inp:focus{border-color:var(--blue);}
.rename-btns{display:flex;gap:7px;margin-top:10px;}
.rename-ok{flex:1;padding:11px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--cyan));border:none;color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;}
.rename-cancel{padding:11px 15px;border-radius:10px;background:none;border:1px solid var(--border2);color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;}
.color-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.color-dot{width:26px;height:26px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;}
.color-dot.selected{border-color:#fff;transform:scale(1.15);}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--s3);border:1px solid var(--border2);border-radius:12px;padding:8px 16px;font-size:12px;font-weight:600;opacity:0;transition:all .3s;pointer-events:none;z-index:999;white-space:nowrap;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
</style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo">
      <div class="logo-mark">ğŸ™</div>
      <div>
        <div class="logo-text">NoteAI</div>
        <div class="logo-sub">à¸šà¸±à¸™à¸—à¸¶à¸ Â· à¸ªà¸£à¸¸à¸› Â· à¹à¸›à¸¥</div>
      </div>
    </div>
    <div class="hdr-r">
      <div class="icon-btn" onclick="showKeyModal()">ğŸ”‘</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: RECORD â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page active" id="page-record">
    <div class="demo-banner" id="demo-banner">ğŸ­ Demo â€” à¹ƒà¸ªà¹ˆ API Key à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡</div>

    <!-- Mode bar -->
    <div class="mode-bar">
      <button class="modebt active" id="mb-rec"  onclick="setMode('rec',this)">ğŸ™ï¸<br>à¸šà¸±à¸™à¸—à¸¶à¸</button>
      <button class="modebt" id="mb-file" onclick="setMode('file',this)">ğŸ“‚<br>à¹„à¸Ÿà¸¥à¹Œ</button>
      <button class="modebt" id="mb-yt"   onclick="setMode('yt',this)">ğŸ“<br>à¸§à¸²à¸‡ Text</button>
      <button class="modebt" id="mb-tl"   onclick="setMode('tl',this)">ğŸŒ<br>à¹à¸›à¸¥à¸ªà¸”</button>
    </div>

    <!-- Translate language selector (shown in tl mode) -->
    <div class="tl-bar" id="tl-bar">
      <div class="tl-hdr">ğŸŒ à¹€à¸¥à¸·à¸­à¸à¸ à¸²à¸©à¸²à¹à¸›à¸¥</div>
      <div class="lang-row">
        <select class="lang-sel" id="tl-src">
          <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        </select>
        <span class="swap-ic" onclick="swapTlLangs()">â‡„</span>
        <select class="lang-sel" id="tl-dst">
          <option value="en" selected>ğŸ‡ºğŸ‡¸ English</option><option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
        </select>
      </div>
    </div>

    <!-- Rec Hero -->
    <div class="rec-hero" id="rec-hero">
      <div class="orb-wrap">
        <div class="orb-ring"></div><div class="orb-ring"></div><div class="orb-ring"></div>
        <button class="rec-btn" id="rec-btn" onclick="toggleRec()">ğŸ™ï¸</button>
      </div>
      <div class="waveform" id="waveform"></div>
      <div>
        <div class="rec-label" id="rec-label">à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸šà¸±à¸™à¸—à¸¶à¸</div>
        <div class="rec-timer" id="rec-timer">00:00</div>
      </div>
    </div>

    <!-- Live transcript -->
    <div class="live-box" id="live-box">
      <div class="lt-hdr"><span class="lt-dot"></span>à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸”</div>
      <div class="lt-text" id="lt-text">à¸à¸³à¸¥à¸±à¸‡à¸Ÿà¸±à¸‡â€¦<span class="cursor"></span></div>
    </div>

    <!-- File upload -->
    <div class="upload-zone" id="upload-zone" style="display:none"
      onclick="document.getElementById('file-inp').click()"
      ondragover="event.preventDefault();this.classList.add('over')"
      ondragleave="this.classList.remove('over')"
      ondrop="handleDrop(event)">
      <div class="ui">ğŸ“‚</div>
      <div class="ut">à¸™à¸³à¹€à¸‚à¹‰à¸²à¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡ / à¸§à¸´à¸”à¸µà¹‚à¸­</div>
      <div class="us">Voice Memos, Files à¸«à¸£à¸·à¸­à¹à¸­à¸›à¸­à¸·à¹ˆà¸™</div>
      <div class="fmt-row"><span class="fmt">M4A</span><span class="fmt">MP3</span><span class="fmt">WAV</span><span class="fmt">MP4</span><span class="fmt">WEBM</span></div>
    </div>
    <input type="file" id="file-inp" accept="audio/*,video/*" style="display:none" onchange="handleFile(event)">
    <div class="file-prev" id="file-prev">
      <div class="file-info-row">
        <div class="file-ic">ğŸµ</div>
        <div style="min-width:0"><div class="file-name" id="file-name"></div><div class="file-size" id="file-size"></div></div>
      </div>
      <div class="file-btns">
        <button class="fa-btn pri" onclick="processFile()">âš¡ à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥</button>
        <button class="fa-btn sec" onclick="clearFile()">âœ• à¸¢à¸à¹€à¸¥à¸´à¸</button>
      </div>
    </div>

    <!-- YouTube/Text zone -->
    <div class="yt-zone" id="yt-zone">
      <div class="yt-title">ğŸ“ à¸§à¸²à¸‡ Transcript / à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</div>
      <div class="yt-tabs">
        <button class="yt-tab active" onclick="setYtTab('text',this)">âœï¸ à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>
        <button class="yt-tab" onclick="setYtTab('url',this)">ğŸ”— YouTube URL</button>
      </div>
      <div id="yt-text-pane">
        <textarea class="yt-inp" id="yt-text" rows="5" placeholder="à¸§à¸²à¸‡ transcript à¸ˆà¸²à¸ YouTube / à¸šà¸—à¸„à¸§à¸²à¸¡ / à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸”à¸à¹‡à¹„à¸”à¹‰ à¹à¸¥à¹‰à¸§à¸à¸” à¸ªà¸£à¸¸à¸›&#10;&#10;à¸§à¸´à¸˜à¸µà¸”à¸¶à¸‡ YouTube Transcript:&#10;1. à¹€à¸›à¸´à¸”à¸§à¸´à¸”à¸µà¹‚à¸­à¹ƒà¸™ YouTube&#10;2. à¸à¸” Â·Â·Â· à¹ƒà¸•à¹‰à¸§à¸´à¸”à¸µà¹‚à¸­ â†’ Show transcript&#10;3. à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§à¸§à¸²à¸‡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ"></textarea>
        <button class="yt-btn" onclick="processText()">ğŸ§  à¸ªà¸£à¸¸à¸›à¸”à¹‰à¸§à¸¢ AI</button>
      </div>
      <div id="yt-url-pane" style="display:none">
        <input class="yt-inp" id="yt-url" type="url" placeholder="https://youtube.com/watch?v=...">
        <div class="yt-note">âš ï¸ YouTube API à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸ˆà¸²à¸ browser à¹‚à¸”à¸¢à¸•à¸£à¸‡<br>à¹à¸™à¸°à¸™à¸³: à¸”à¸¶à¸‡ transcript à¸ˆà¸²à¸ YouTube à¹à¸¥à¹‰à¸§à¸§à¸²à¸‡à¹ƒà¸™à¹à¸—à¹‡à¸š "à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡"</div>
        <button class="yt-btn" style="background:var(--s2);border:1px solid var(--border2);color:var(--text2);" onclick="setYtTab('text',document.querySelector('.yt-tab'))">â† à¹„à¸›à¸«à¸™à¹‰à¸²à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>
      </div>
    </div>

    <!-- Processing -->
    <div class="proc-card" id="proc-card">
      <div class="proc-title">à¸à¸³à¸¥à¸±à¸‡à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥</div>
      <div class="psteps">
        <div class="pstep" id="ps1"><div class="pstep-ic">ğŸ“¤</div><div><div class="pstep-name" id="ps1n">à¸ªà¹ˆà¸‡à¹€à¸ªà¸µà¸¢à¸‡à¹„à¸› OpenAI</div><div class="pstep-desc">Whisper API</div></div></div>
        <div class="pstep" id="ps2"><div class="pstep-ic">âœï¸</div><div><div class="pstep-name">à¸–à¸­à¸”à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</div><div class="pstep-desc">à¹à¸¢à¸à¸œà¸¹à¹‰à¸à¸¹à¸” + timestamp</div></div></div>
        <div class="pstep" id="ps3"><div class="pstep-ic">ğŸ§ </div><div><div class="pstep-name" id="ps3n">GPT-4o à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ</div><div class="pstep-desc">à¸ªà¸£à¸¸à¸› Â· Actions Â· Mind Map</div></div></div>
        <div class="pstep" id="ps4"><div class="pstep-ic">ğŸ“Š</div><div><div class="pstep-name">à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™</div><div class="pstep-desc">à¸à¸£à¹‰à¸­à¸¡à¹à¸ªà¸”à¸‡à¸œà¸¥</div></div></div>
      </div>
    </div>

    <!-- Result -->
    <div class="result-wrap" id="result-wrap">
      <div class="result-head">
        <div class="result-title" id="result-title">ğŸ“„ à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ</div>
        <div class="result-chips">
          <div class="chip" id="chip-dur">--:--</div>
          <div class="chip" id="chip-spk">-- à¸„à¸™</div>
          <div class="chip vio" id="chip-lang" style="display:none"></div>
        </div>
      </div>
      <div class="report-scroll">
        <button class="rtype active" onclick="setRtype(this)">ğŸ“‹ à¸›à¸£à¸°à¸Šà¸¸à¸¡</button>
        <button class="rtype" onclick="setRtype(this)">ğŸ’¼ à¸‚à¸²à¸¢</button>
        <button class="rtype" onclick="setRtype(this)">ğŸ¤ à¸ªà¸±à¸¡à¸ à¸²à¸©à¸“à¹Œ</button>
        <button class="rtype" onclick="setRtype(this)">ğŸ“š à¸šà¸£à¸£à¸¢à¸²à¸¢</button>
        <button class="rtype" onclick="setRtype(this)">â–¶ï¸ à¸§à¸´à¸”à¸µà¹‚à¸­</button>
        <button class="rtype" onclick="setRtype(this)">âš™ï¸ à¸—à¸±à¹ˆà¸§à¹„à¸›</button>
      </div>
      <div class="ctabs">
        <button class="ctab active" onclick="switchTab(this,'tab-transcript')">ğŸ“ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>
        <button class="ctab" onclick="switchTab(this,'tab-summary')">ğŸ“‹ à¸ªà¸£à¸¸à¸›</button>
        <button class="ctab" onclick="switchTab(this,'tab-actions')">âœ… à¸‡à¸²à¸™</button>
        <button class="ctab" onclick="switchTab(this,'tab-mindmap')">ğŸ—ºï¸ Map</button>
      </div>
      <div class="result-body">
        <!-- Transcript -->
        <div class="tab-pane active" id="tab-transcript">
          <div class="trs-hd">
            <span class="trs-note" id="trs-note"></span>
            <div class="lang-toggle" id="lang-toggle" style="display:none">
              <button class="ltb active" id="ltb-orig" onclick="showLang('orig')">à¸•à¹‰à¸™à¸‰à¸šà¸±à¸š</button>
              <button class="ltb" id="ltb-trans" onclick="showLang('trans')">à¹à¸›à¸¥</button>
              <button class="ltb" id="ltb-both" onclick="showLang('both')">à¸—à¸±à¹‰à¸‡à¸„à¸¹à¹ˆ</button>
            </div>
          </div>
          <div id="transcript-content"></div>
        </div>
        <!-- Summary -->
        <div class="tab-pane" id="tab-summary">
          <div class="detail-selector">
            <button class="dl-btn" onclick="setDetail('low',this)">à¸™à¹‰à¸­à¸¢</button>
            <button class="dl-btn active" onclick="setDetail('mid',this)">à¸à¸¥à¸²à¸‡</button>
            <button class="dl-btn" onclick="setDetail('high',this)">à¸¡à¸²à¸</button>
          </div>
          <div class="sum-block"><div class="sum-lbl">à¸ªà¸£à¸¸à¸›à¸ à¸²à¸à¸£à¸§à¸¡</div><div class="sum-text" id="sum-overview"></div></div>
          <div class="sum-block" id="sum-pts-blk"><div class="sum-lbl">à¸›à¸£à¸°à¹€à¸”à¹‡à¸™à¸ªà¸³à¸„à¸±à¸</div><div id="sum-pts"></div></div>
          <div class="sum-block" id="sum-dec-blk"><div class="sum-lbl">à¸‚à¹‰à¸­à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ</div><div class="sum-text" id="sum-dec"></div></div>
          <div class="sum-block" id="sum-det-blk" style="display:none"><div class="sum-lbl">à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”</div><div id="sum-det"></div></div>
        </div>
        <!-- Actions -->
        <div class="tab-pane" id="tab-actions">
          <div style="padding-bottom:8px"><span style="font-size:10px;color:var(--text2)" id="ac-count"></span></div>
          <ul class="action-list" id="action-list"></ul>
        </div>
        <!-- Mind Map -->
        <div class="tab-pane" id="tab-mindmap">
          <div class="mm-pane">
            <div class="mm-toolbar">
              <div class="mm-tl-lbl">ğŸ—ºï¸ Mind Map</div>
              <div class="mm-ctrls">
                <div class="mc w" onclick="mmExpandAll()">à¸‚à¸¢à¸²à¸¢</div>
                <div class="mc w" onclick="mmCollapseAll()">à¸¢à¹ˆà¸­</div>
                <div class="mc" onclick="mmZoom(.18)">+</div>
                <div class="mc" onclick="mmZoom(-.18)">âˆ’</div>
                <div class="mc" onclick="mmReset()" style="font-size:9px">âŠ™</div>
              </div>
            </div>
            <div class="mm-canvas" id="mm-canvas"><svg id="mm-svg"></svg></div>
          </div>
        </div>
      </div>
      <div class="export-row">
        <button class="exp-btn" onclick="exportTXT()">ğŸ“„ TXT</button>
        <button class="exp-btn" onclick="exportJSON()">ğŸ“¦ JSON</button>
        <button class="exp-btn" onclick="copyAll()">ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸</button>
        <button class="exp-btn" onclick="shareResult()">ğŸ“¤ à¹à¸Šà¸£à¹Œ</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: TRANSLATE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-translate">
    <div class="tl-page-hdr" style="padding:16px 20px 12px">ğŸŒ à¹à¸›à¸¥à¸ªà¸”</div>
    <div style="padding:0 20px">
      <div class="lang-pair-row">
        <select class="lp-sel" id="tl2-src">
          <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option><option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        </select>
        <div class="lp-swap" onclick="swapTl2()">â‡„</div>
        <select class="lp-sel" id="tl2-dst">
          <option value="en" selected>ğŸ‡ºğŸ‡¸ English</option><option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option><option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        </select>
      </div>
      <div class="tl-rec-card">
        <div class="tl-wv" id="tl2-wv">
          <div class="tl-wvb" style="animation-delay:0s"></div><div class="tl-wvb" style="animation-delay:.07s"></div>
          <div class="tl-wvb" style="animation-delay:.14s"></div><div class="tl-wvb" style="animation-delay:.21s"></div>
          <div class="tl-wvb" style="animation-delay:.28s"></div><div class="tl-wvb" style="animation-delay:.35s"></div>
          <div class="tl-wvb" style="animation-delay:.42s"></div><div class="tl-wvb" style="animation-delay:.49s"></div>
        </div>
        <button class="tl-rec-btn" id="tl2-btn" onclick="toggleTlRec()">ğŸ™ï¸</button>
        <div class="tl-rec-hint" id="tl2-hint">à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¸à¸¹à¸” â†’ à¹à¸›à¸¥à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´</div>
        <div class="tl-timer" id="tl2-timer">00:00</div>
      </div>
      <div class="tl-result" id="tl2-result">
        <div class="tl-lang-bar">
          <span class="tl-badge orig" id="tl2-badge-orig">à¹„à¸—à¸¢</span>
          <span style="color:var(--text3)">â†’</span>
          <span class="tl-badge trans" id="tl2-badge-dst">English</span>
        </div>
        <div class="tl-sec"><div class="tl-sec-text orig" id="tl2-orig-text"></div></div>
        <div class="tl-sec"><div class="tl-sec-text trans" id="tl2-trans-text"></div></div>
        <div class="tl-actions">
          <button class="tl-act-btn" id="tl2-speak-btn" onclick="speakTl2Trans()">ğŸ”Š à¸­à¹ˆà¸²à¸™à¸„à¸³à¹à¸›à¸¥</button>
          <button class="tl-act-btn" onclick="speakTl2Orig()">ğŸ—£ï¸ à¸•à¹‰à¸™à¸‰à¸šà¸±à¸š</button>
          <button class="tl-act-btn" onclick="copyTl2()">ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸</button>
        </div>
      </div>
      <div id="tl2-hist-wrap" style="display:none">
        <div class="tl-hist-title">à¸›à¸£à¸°à¸§à¸±à¸•à¸´</div>
        <div id="tl2-hist-list"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: CONVERSATION â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-convo">
    <div class="tl-page-hdr" style="padding:16px 20px 12px">ğŸ’¬ à¸ªà¸™à¸—à¸™à¸² 2 à¸ à¸²à¸©à¸²</div>
    <div style="padding:0 20px">
      <div class="convo-hdr">
        <div class="pc" id="card-a">
          <div class="pc-av">ğŸ‘¤</div>
          <div class="pc-nm">à¸„à¸™à¸—à¸µà¹ˆ 1</div>
          <div class="pc-lg"><select id="cv-lang-a" onchange="updateCvHints()">
            <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          </select></div>
        </div>
        <div style="display:flex;align-items:center;font-size:20px;color:var(--text3);flex-shrink:0">â‡„</div>
        <div class="pc" id="card-b">
          <div class="pc-av">ğŸ‘¥</div>
          <div class="pc-nm">à¸„à¸™à¸—à¸µà¹ˆ 2</div>
          <div class="pc-lg"><select id="cv-lang-b" onchange="updateCvHints()">
            <option value="en" selected>ğŸ‡ºğŸ‡¸ English</option><option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          </select></div>
        </div>
      </div>
      <div class="convo-feed" id="cv-feed">
        <div class="cv-empty" id="cv-empty">à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸à¸¹à¸”<br>à¸£à¸°à¸šà¸šà¸ˆà¸°à¹à¸›à¸¥à¹ƒà¸«à¹‰à¸­à¸µà¸à¸à¹ˆà¸²à¸¢à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´<br>à¸à¸£à¹‰à¸­à¸¡à¸­à¹ˆà¸²à¸™à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡ ğŸ”Š</div>
      </div>
      <div class="convo-btns">
        <button class="cv-btn a" id="cv-btn-a" onclick="startCvRec('a')">
          <span style="font-size:21px">ğŸ™ï¸</span>
          <div class="cv-btn-inner">
            <span class="cv-btn-name">à¸„à¸™à¸—à¸µà¹ˆ 1 à¸à¸¹à¸”</span>
            <span class="cv-btn-hint" id="cv-hint-a">à¹„à¸—à¸¢ â†’ English</span>
          </div>
        </button>
        <button class="cv-btn b" id="cv-btn-b" onclick="startCvRec('b')">
          <span style="font-size:21px">ğŸ™ï¸</span>
          <div class="cv-btn-inner">
            <span class="cv-btn-name">à¸„à¸™à¸—à¸µà¹ˆ 2 à¸à¸¹à¸”</span>
            <span class="cv-btn-hint" id="cv-hint-b">English â†’ à¹„à¸—à¸¢</span>
          </div>
        </button>
      </div>
      <div class="convo-footer">
        <button class="cf-btn" onclick="exportCv()">ğŸ“„ Export</button>
        <button class="cf-btn" onclick="shareCv()">ğŸ“¤ à¹à¸Šà¸£à¹Œ</button>
        <button class="cf-btn red" onclick="clearCv()">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: HISTORY â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-history">
    <div class="page-hdr">à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸</div>
    <div class="hist-list" id="hist-list"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE: SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-settings">
    <div class="settings-body">
      <div class="set-sec">
        <div class="set-sec-title">OpenAI API Key</div>
        <input type="password" class="inp" id="s-key" placeholder="sk-proj-...">
        <button class="btn-save" onclick="saveKey()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸</button>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">à¸ à¸²à¸©à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</div>
        <div class="set-row">
          <div><div class="set-label">à¸•à¹‰à¸™à¸—à¸²à¸‡</div></div>
          <select class="sel-set" id="def-src" style="width:auto;margin:0">
            <option value="th">à¹„à¸—à¸¢ ğŸ‡¹ğŸ‡­</option><option value="en">English ğŸ‡ºğŸ‡¸</option>
            <option value="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option><option value="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
          </select>
        </div>
        <div class="set-row">
          <div><div class="set-label">à¸›à¸¥à¸²à¸¢à¸—à¸²à¸‡</div></div>
          <select class="sel-set" id="def-dst" style="width:auto;margin:0">
            <option value="en" selected>English ğŸ‡ºğŸ‡¸</option><option value="th">à¹„à¸—à¸¢ ğŸ‡¹ğŸ‡­</option>
            <option value="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option><option value="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
          </select>
        </div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ</div>
        <div class="set-row"><div><div class="set-label">à¹à¸¢à¸à¹€à¸ªà¸µà¸¢à¸‡à¸œà¸¹à¹‰à¸à¸¹à¸”</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
        <div class="set-row"><div><div class="set-label">Mind Map à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
        <div class="set-row"><div><div class="set-label">à¸­à¹ˆà¸²à¸™à¸„à¸³à¹à¸›à¸¥à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡</div></div><button class="toggle on" id="tts-toggle" onclick="this.classList.toggle('on')"></button></div>
        <div class="set-row"><div><div class="set-label">à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸”à¸‚à¸“à¸°à¸šà¸±à¸™à¸—à¸¶à¸</div></div><button class="toggle on" onclick="this.classList.toggle('on')"></button></div>
      </div>
      <div class="set-sec">
        <div class="set-sec-title">à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢ (à¸›à¸£à¸°à¸¡à¸²à¸“)</div>
        <div class="set-row"><div><div class="set-label">Whisper à¸–à¸­à¸”à¹€à¸ªà¸µà¸¢à¸‡</div></div><div style="font-size:11px;color:var(--text2)">~à¸¿0.20/à¸™à¸²à¸—à¸µ</div></div>
        <div class="set-row"><div><div class="set-label">GPT-4o à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ</div></div><div style="font-size:11px;color:var(--text2)">~à¸¿1.50/à¸„à¸£à¸±à¹‰à¸‡</div></div>
        <div class="set-row"><div><div class="set-label">à¹à¸›à¸¥à¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œ</div></div><div style="font-size:11px;color:var(--amber)">~à¸¿0.05/à¸„à¸£à¸±à¹‰à¸‡</div></div>
        <div class="set-row"><div><div class="set-label">1 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡</div></div><div style="font-size:11px;color:var(--green)">~à¸¿15</div></div>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bnav">
    <button class="bnav-item active" id="bn-record" onclick="goPage('record')"><div class="bnav-ic">ğŸ™ï¸</div><div class="bnav-lbl">à¸šà¸±à¸™à¸—à¸¶à¸</div></button>
    <button class="bnav-item" id="bn-translate" onclick="goPage('translate')"><div class="bnav-ic">ğŸŒ</div><div class="bnav-lbl">à¹à¸›à¸¥à¸ªà¸”</div></button>
    <button class="bnav-item" id="bn-convo" onclick="goPage('convo')"><div class="bnav-ic">ğŸ’¬</div><div class="bnav-lbl">à¸ªà¸™à¸—à¸™à¸²</div></button>
    <button class="bnav-item" id="bn-history" onclick="goPage('history')"><div class="bnav-ic">ğŸ“</div><div class="bnav-lbl">à¸›à¸£à¸°à¸§à¸±à¸•à¸´</div></button>
    <button class="bnav-item" id="bn-settings" onclick="goPage('settings')"><div class="bnav-ic">âš™ï¸</div><div class="bnav-lbl">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</div></button>
  </nav>
</div>

<!-- Speaker Rename Modal -->
<div class="rename-modal" id="rename-modal">
  <div class="rename-box">
    <div class="rename-title">âœï¸ à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸à¸¹à¸”</div>
    <div class="rename-sub" id="rename-sub"></div>
    <input class="rename-inp" id="rename-inp" placeholder="à¹€à¸Šà¹ˆà¸™ à¸ªà¸¡à¸Šà¸²à¸¢, à¸§à¸´à¸ à¸², à¸¥à¸¹à¸à¸„à¹‰à¸²..." maxlength="30">
    <div class="color-row" id="color-row"></div>
    <div class="rename-btns">
      <button class="rename-ok" onclick="saveRename()">âœ… à¸šà¸±à¸™à¸—à¸¶à¸</button>
      <button class="rename-cancel" onclick="closeRename()">à¸¢à¸à¹€à¸¥à¸´à¸</button>
    </div>
  </div>
</div>

<!-- API Key Modal -->
<div class="modal-bg" id="key-modal">
  <div class="modal-box">
    <div class="modal-title">ğŸ”‘ OpenAI API Key</div>
    <div class="modal-sub">à¹ƒà¸ªà¹ˆ key à¸ˆà¸²à¸ platform.openai.com<br>à¸«à¸£à¸·à¸­à¸à¸” Demo à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸¥à¸­à¸‡à¹ƒà¸Šà¹‰à¸à¹ˆà¸­à¸™</div>
    <input type="password" class="inp" id="m-key" placeholder="sk-proj-...">
    <button class="btn-pri" onclick="saveKeyModal()">âœ… à¸šà¸±à¸™à¸—à¸¶à¸</button>
    <button class="btn-sec" onclick="demoMode()">ğŸ­ à¸—à¸”à¸¥à¸­à¸‡ Demo</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONSTANTS & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LANG_NAME = {th:'à¸ à¸²à¸©à¸²à¹„à¸—à¸¢',en:'English',zh:'à¸ à¸²à¸©à¸²à¸ˆà¸µà¸™',ja:'à¸ à¸²à¸©à¸²à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™',ko:'à¸ à¸²à¸©à¸²à¹€à¸à¸²à¸«à¸¥à¸µ',fr:'à¸ à¸²à¸©à¸²à¸à¸£à¸±à¹ˆà¸‡à¹€à¸¨à¸ª',de:'à¸ à¸²à¸©à¸²à¹€à¸¢à¸­à¸£à¸¡à¸±à¸™',es:'à¸ à¸²à¸©à¸²à¸ªà¹€à¸›à¸™'};
const LANG_FLAG = {th:'ğŸ‡¹ğŸ‡­',en:'ğŸ‡ºğŸ‡¸',zh:'ğŸ‡¨ğŸ‡³',ja:'ğŸ‡¯ğŸ‡µ',ko:'ğŸ‡°ğŸ‡·',fr:'ğŸ‡«ğŸ‡·',de:'ğŸ‡©ğŸ‡ª',es:'ğŸ‡ªğŸ‡¸'};
const TTS_CODE  = {th:'th-TH',en:'en-US',zh:'zh-CN',ja:'ja-JP',ko:'ko-KR',fr:'fr-FR',de:'de-DE',es:'es-ES'};
const SPK_COLORS = ['#4f8ef7','#22c55e','#f59e0b','#f43f5e','#a78bfa','#22d3ee','#fb923c','#e879f9'];

let apiKey = localStorage.getItem('nai_key') || '';
let isRec=false, mr=null, chunks=[], timerInt=null, recSecs=0;
let selectedFile=null, currentResult=null, currentMode='rec';
let showLangMode='orig', renameIdx=-1;
let history = JSON.parse(localStorage.getItem('nai_hist')||'[]');

// Translate page
let tl2Rec=null, tl2Chunks=[], tl2Timer=null, tl2Secs=0;
let tl2History=[], tl2CurOrig='', tl2CurTrans='', tl2CurDst='';

// Conversation page
let cvRec=null, cvChunks=[], cvActiveSide=null, cvBubbles=0, cvHistory=[];

// Mind map
let mmScale=1, mmOx=8, mmOy=8, mmDrag=false, mmPx=0, mmPy=0;
let mmOpen=new Set(), mmDetOpen=new Set(), mmData=null, mmG=null;
const NS='http://www.w3.org/2000/svg';

// Demo phrases
const DP = {
  th:['à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¸£à¸±à¸š à¸¢à¸´à¸™à¸”à¸µà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸¹à¹‰à¸ˆà¸±à¸','à¸§à¸±à¸™à¸™à¸µà¹‰à¸­à¸²à¸à¸²à¸¨à¸”à¸µà¸¡à¸²à¸à¹€à¸¥à¸¢à¸„à¸£à¸±à¸š','à¸„à¸¸à¸“à¸¡à¸²à¸ˆà¸²à¸à¸—à¸µà¹ˆà¹„à¸«à¸™à¸„à¸£à¸±à¸š','à¸œà¸¡à¸Šà¸­à¸šà¸à¸´à¸™à¸­à¸²à¸«à¸²à¸£à¹„à¸—à¸¢à¸¡à¸²à¸à¸„à¸£à¸±à¸š'],
  en:['Hello, nice to meet you!','The weather is great today.','Where are you from?','I really love Thai food!'],
  zh:['ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ','ä»Šå¤©å¤©æ°”å¾ˆå¥½','ä½ ä»å“ªé‡Œæ¥','æˆ‘éå¸¸å–œæ¬¢æ³°å›½èœ'],
  ja:['ã“ã‚“ã«ã¡ã¯ã€ã¯ã˜ã‚ã¾ã—ã¦','ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­','ã©ã“ã‹ã‚‰æ¥ã¾ã—ãŸã‹','ã‚¿ã‚¤æ–™ç†ãŒå¤§å¥½ãã§ã™'],
  ko:['ì•ˆë…•í•˜ì„¸ìš”, ë°˜ê°‘ìŠµë‹ˆë‹¤','ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ë„¤ìš”','ì–´ë””ì„œ ì˜¤ì…¨ì–´ìš”?','íƒœêµ­ ìŒì‹ ì •ë§ ì¢‹ì•„í•´ìš”'],
};
const DT = {
  'th-en':['Hello, nice to meet you!','The weather is great today.','Where are you from?','I love Thai food!'],
  'en-th':['à¸ªà¸§à¸±à¸ªà¸”à¸µ à¸¢à¸´à¸™à¸”à¸µà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸¹à¹‰à¸ˆà¸±à¸!','à¸­à¸²à¸à¸²à¸¨à¸§à¸±à¸™à¸™à¸µà¹‰à¸”à¸µà¸¡à¸²à¸','à¸„à¸¸à¸“à¸¡à¸²à¸ˆà¸²à¸à¹„à¸«à¸™?','à¸œà¸¡à¸Šà¸­à¸šà¸­à¸²à¸«à¸²à¸£à¹„à¸—à¸¢à¸¡à¸²à¸'],
  'th-zh':['ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ','ä»Šå¤©å¤©æ°”å¾ˆå¥½','ä½ ä»å“ªé‡Œæ¥ï¼Ÿ','æˆ‘éå¸¸å–œæ¬¢æ³°å›½èœ'],
  'en-zh':['ä½ å¥½ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ','ä»Šå¤©å¤©æ°”å¾ˆå¥½','ä½ ä»å“ªé‡Œæ¥ï¼Ÿ','æˆ‘éå¸¸å–œæ¬¢æ³°å›½èœ'],
  'th-ja':['ã“ã‚“ã«ã¡ã¯ã€ã¯ã˜ã‚ã¾ã—ã¦','ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­','ã©ã¡ã‚‰ã‹ã‚‰ã§ã™ã‹ï¼Ÿ','ã‚¿ã‚¤æ–™ç†ãŒå¤§å¥½ãã§ã™'],
  'th-ko':['ì•ˆë…•í•˜ì„¸ìš” ë°˜ê°‘ìŠµë‹ˆë‹¤','ì˜¤ëŠ˜ ë‚ ì”¨ ì¢‹ë„¤ìš”','ì–´ë””ì„œ ì˜¤ì…¨ë‚˜ìš”ï¼Ÿ','íƒœêµ­ ìŒì‹ ì¢‹ì•„í•´ìš”'],
  'ja-th':['à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¸£à¸±à¸š','à¸­à¸²à¸à¸²à¸¨à¸§à¸±à¸™à¸™à¸µà¹‰à¸”à¸µà¸™à¸°à¸„à¸£à¸±à¸š','à¸„à¸¸à¸“à¸¡à¸²à¸ˆà¸²à¸à¹„à¸«à¸™à¸„à¸£à¸±à¸š','à¸Šà¸­à¸šà¸­à¸²à¸«à¸²à¸£à¹„à¸—à¸¢à¸¡à¸²à¸à¸„à¸£à¸±à¸š'],
  'ko-th':['à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¸£à¸±à¸š à¸¢à¸´à¸™à¸”à¸µà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸¹à¹‰à¸ˆà¸±à¸','à¸­à¸²à¸à¸²à¸¨à¸”à¸µà¸¡à¸²à¸à¸™à¸°','à¸¡à¸²à¸ˆà¸²à¸à¸—à¸µà¹ˆà¹„à¸«à¸™à¸„à¸£à¸±à¸š','à¸Šà¸­à¸šà¸­à¸²à¸«à¸²à¸£à¹„à¸—à¸¢à¸¡à¸²à¸à¹€à¸¥à¸¢'],
};
let demoIdx = {tl:0, a:0, b:0};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEMO DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEMO = {
  speakers:[
    {id:'S1',name:'à¸ªà¸¡à¸Šà¸²à¸¢ (à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£)',color:'#4f8ef7',
     lines:['à¸ªà¸§à¸±à¸ªà¸”à¸µà¸—à¸¸à¸à¸„à¸™à¸„à¸£à¸±à¸š à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸£à¸²à¸›à¸£à¸°à¸Šà¸¸à¸¡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹à¸œà¸™à¸‚à¸¢à¸²à¸¢à¸˜à¸¸à¸£à¸à¸´à¸ˆà¹„à¸•à¸£à¸¡à¸²à¸ª 4 à¸„à¸£à¸±à¸š à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸„à¸·à¸­ 8 à¸¥à¹‰à¸²à¸™à¸šà¸²à¸—','à¹€à¸£à¸²à¸•à¹‰à¸­à¸‡à¸§à¸²à¸‡à¹à¸œà¸™à¸à¸²à¸£à¸•à¸¥à¸²à¸”à¸Šà¹ˆà¸§à¸‡à¹€à¸—à¸¨à¸à¸²à¸¥à¸›à¸¥à¸²à¸¢à¸›à¸µà¹ƒà¸«à¹‰à¸Šà¸±à¸”à¹€à¸ˆà¸™ à¸—à¸¸à¸à¸—à¸µà¸¡à¸•à¹‰à¸­à¸‡à¸Šà¹ˆà¸§à¸¢à¸à¸±à¸™à¸„à¸£à¸±à¸š','à¸‚à¸­à¹ƒà¸«à¹‰à¸—à¸µà¸¡à¸‚à¸²à¸¢à¸£à¸²à¸¢à¸‡à¸²à¸™à¸œà¸¥à¸à¹ˆà¸­à¸™à¹€à¸¥à¸¢à¸„à¸£à¸±à¸š','à¸”à¸µà¸¡à¸²à¸à¸„à¸£à¸±à¸š à¹€à¸à¸´à¸™à¹€à¸›à¹‰à¸²à¸—à¸µà¹ˆà¸•à¸±à¹‰à¸‡à¹„à¸§à¹‰ à¸ªà¸³à¸«à¸£à¸±à¸š Q4 à¹€à¸£à¸²à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‰à¸² 8 à¸¥à¹‰à¸²à¸™à¸šà¸²à¸—'],
     lines_trans:['Good morning everyone. Today we discuss the Q4 business expansion plan. Target is 8 million baht.','We need clear marketing plans for the year-end festival. All teams must work together.','Please let the sales team report first.','Excellent! That exceeds our target. For Q4 we aim for 8 million baht.']},
    {id:'S2',name:'à¸§à¸´à¸ à¸² (à¸—à¸µà¸¡à¸‚à¸²à¸¢)',color:'#22c55e',
     lines:['à¸„à¹ˆà¸° à¹€à¸”à¸·à¸­à¸™à¸à¸±à¸™à¸¢à¸²à¸¢à¸™à¸¢à¸­à¸”à¸‚à¸²à¸¢à¸£à¸§à¸¡ 2.3 à¸¥à¹‰à¸²à¸™ à¹€à¸à¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™ 15% à¸ˆà¸²à¸à¹€à¸”à¸·à¸­à¸™à¸à¹ˆà¸­à¸™ à¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸«à¸¡à¹ˆ 23 à¸£à¸²à¸¢','Retention Rate 67% à¸„à¹ˆà¸° à¸à¸¥à¸¸à¹ˆà¸¡ B2B à¹à¸‚à¹‡à¸‡à¹à¸à¸£à¹ˆà¸‡à¸¡à¸²à¸ à¸ˆà¸°à¸•à¸´à¸”à¸•à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸à¹ˆà¸² 45 à¸£à¸²à¸¢à¸„à¹ˆà¸°'],
     lines_trans:['September total sales were 2.3M baht, up 15% with 23 new customers.','Retention rate 67%. B2B segment is strong. We will contact 45 existing customers.']},
    {id:'S3',name:'à¸˜à¸™à¸² (à¸à¸²à¸£à¸•à¸¥à¸²à¸”)',color:'#f59e0b',
     lines:['Facebook Ads Conversion Rate 4.2% à¸„à¸£à¸±à¸š à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸² benchmark 2.8%','à¹€à¸ªà¸™à¸­à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸š LINE OA à¸Šà¹ˆà¸§à¸‡à¹€à¸—à¸¨à¸à¸²à¸¥ engagement à¸ªà¸¹à¸‡à¸¡à¸²à¸à¸„à¸£à¸±à¸š'],
     lines_trans:['Facebook Ads conversion rate is 4.2%, above the 2.8% industry benchmark.','I recommend increasing LINE OA budget for the festival season due to high engagement.']},
  ],
  summary:{
    overview:'à¸›à¸£à¸°à¸Šà¸¸à¸¡à¹à¸œà¸™à¸˜à¸¸à¸£à¸à¸´à¸ˆ Q4 à¸¢à¸­à¸”à¸‚à¸²à¸¢ Sep 2.3M +15% à¸•à¸±à¹‰à¸‡à¹€à¸›à¹‰à¸² Q4 à¸—à¸µà¹ˆ 8 à¸¥à¹‰à¸²à¸™à¸šà¸²à¸— à¸§à¸²à¸‡à¹à¸œà¸™à¹à¸„à¸¡à¹€à¸›à¸à¸›à¸¥à¸²à¸¢à¸›à¸µ',
    points:['à¸¢à¸­à¸”à¸‚à¸²à¸¢ Q3 à¹€à¸à¸´à¹ˆà¸¡ 15% à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆ 2.3 à¸¥à¹‰à¸²à¸™','à¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸«à¸¡à¹ˆ 23 à¸£à¸²à¸¢ Retention 67%','Facebook Ads 4.2% à¹€à¸à¸´à¸™ benchmark','à¹€à¸›à¹‰à¸² Q4 à¸„à¸·à¸­ 8 à¸¥à¹‰à¸²à¸™à¸šà¸²à¸—','à¹à¸„à¸¡à¹€à¸›à¸ 11.11 à¹à¸¥à¸°à¸›à¸¥à¸²à¸¢à¸›à¸µà¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸'],
    decisions:'à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸š Facebook Ads + LINE OA à¸Šà¹ˆà¸§à¸‡à¹€à¸—à¸¨à¸à¸²à¸¥ à¸™à¸±à¸”à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸•à¸´à¸”à¸•à¸²à¸¡ 15 à¸.à¸¢.',
    detail:['à¸§à¸´à¸ à¸²à¸ˆà¸°à¸•à¸´à¸”à¸•à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸à¹ˆà¸² 45 à¸£à¸²à¸¢à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸‹à¸·à¹‰à¸­','LINE OA engagement à¸ªà¸¹à¸‡à¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¹€à¸—à¸¨à¸à¸²à¸¥','Benchmark à¸­à¸¸à¸•à¸ªà¸²à¸«à¸à¸£à¸£à¸¡ 2.8%']
  },
  actions:[
    {text:'à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸•à¹Šà¸­à¸à¸ªà¸´à¸™à¸„à¹‰à¸²à¸à¹ˆà¸­à¸™ 15 à¸.à¸¢.',assign:'à¸—à¸µà¸¡à¸„à¸¥à¸±à¸‡',pri:'h',subtasks:['à¸•à¸£à¸§à¸ˆà¸™à¸±à¸šà¸ªà¸•à¹Šà¸­à¸','à¸ªà¸±à¹ˆà¸‡à¸‚à¸­à¸‡à¹€à¸à¸´à¹ˆà¸¡','à¸ˆà¸±à¸”à¹€à¸•à¸£à¸µà¸¢à¸¡à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ']},
    {text:'à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸š Facebook Ads + LINE OA',assign:'à¸˜à¸™à¸²',pri:'h',subtasks:['à¸„à¸³à¸™à¸§à¸“à¸‡à¸š','à¸­à¸­à¸à¹à¸šà¸š Creative','à¸•à¸±à¹‰à¸‡ Campaign']},
    {text:'à¸•à¸´à¸”à¸•à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸à¹ˆà¸² 45 à¸£à¸²à¸¢',assign:'à¸§à¸´à¸ à¸²',pri:'m',subtasks:['à¹à¸šà¹ˆà¸‡à¸à¸¥à¸¸à¹ˆà¸¡à¸¥à¸¹à¸à¸„à¹‰à¸²','à¹‚à¸—à¸£à¸à¸¥à¸¸à¹ˆà¸¡ A','à¸ªà¹ˆà¸‡ email à¸à¸¥à¸¸à¹ˆà¸¡ B']},
    {text:'Promotion à¸à¸´à¹€à¸¨à¸© 11.11',assign:'à¸—à¸µà¸¡à¸à¸²à¸£à¸•à¸¥à¸²à¸”',pri:'m',subtasks:['à¸à¸³à¸«à¸™à¸”à¸ªà¹ˆà¸§à¸™à¸¥à¸”','à¸­à¸­à¸à¹à¸šà¸š Banner']},
    {text:'à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¸‡à¸²à¸™ Q3 à¸ªà¹ˆà¸‡à¸œà¸¹à¹‰à¸šà¸£à¸´à¸«à¸²à¸£',assign:'à¸ªà¸¡à¸Šà¸²à¸¢',pri:'l',subtasks:['à¸£à¸§à¸šà¸£à¸§à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥','à¸ˆà¸±à¸”à¸—à¸³ Slide']},
  ],
  mindmap:{
    center:'à¹à¸œà¸™ Q4',
    branches:[
      {label:'1. à¸¢à¸­à¸”à¸‚à¸²à¸¢ Q3',color:'#c0392b',subs:[{label:'à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ',color:'#27ae60',details:['[à¸ªà¸¡à¸Šà¸²à¸¢]: 2.3M +15%']},{label:'à¸¥à¸¹à¸à¸„à¹‰à¸²',color:'#2c3e50',details:['[à¸§à¸´à¸ à¸²]: à¹ƒà¸«à¸¡à¹ˆ 23 à¸£à¸²à¸¢','[à¸§à¸´à¸ à¸²]: Retention 67%']}]},
      {label:'2. à¹€à¸›à¹‰à¸² Q4 = 8M',color:'#d35400',subs:[{label:'à¹à¸œà¸™',color:'#27ae60',details:['[à¸ªà¸¡à¸Šà¸²à¸¢]: à¹€à¸à¸´à¹ˆà¸¡ 247%']}]},
      {label:'3. Facebook Ads',color:'#2980b9',subs:[{label:'à¸œà¸¥',color:'#2c3e50',details:['[à¸˜à¸™à¸²]: 4.2% Conversion','à¹€à¸à¸´à¸™ benchmark 2.8%']}]},
      {label:'4. LINE OA',color:'#27ae60',subs:[{label:'à¹à¸œà¸™',color:'#27ae60',details:['[à¸˜à¸™à¸²]: à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸šà¸›à¸¥à¸²à¸¢à¸›à¸µ']}]},
      {label:'5. à¹à¸„à¸¡à¹€à¸›à¸ 11.11',color:'#8e44ad'},
      {label:'6. à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸à¹ˆà¸²',color:'#16a085',subs:[{label:'à¹à¸œà¸™',color:'#2c3e50',details:['[à¸§à¸´à¸ à¸²]: 45 à¸£à¸²à¸¢à¸—à¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸‹à¸·à¹‰à¸­']}]},
      {label:'7. Action Items',color:'#e67e22',subs:[{label:'à¸‡à¸²à¸™à¸ªà¸³à¸„à¸±à¸',color:'#27ae60',details:['à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸•à¹Šà¸­à¸ â€” à¸—à¸µà¸¡à¸„à¸¥à¸±à¸‡','à¹€à¸à¸´à¹ˆà¸¡à¸‡à¸šà¹‚à¸†à¸©à¸“à¸² â€” à¸˜à¸™à¸²','à¸•à¸´à¸”à¸•à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸² â€” à¸§à¸´à¸ à¸²']}]},
      {label:'8. à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸–à¸±à¸”à¹„à¸›',color:'#9b59b6',subs:[{label:'à¸§à¸±à¸™à¸—à¸µà¹ˆ',color:'#2c3e50',details:['[à¸ªà¸¡à¸Šà¸²à¸¢]: 15 à¸.à¸¢.']}]},
    ]
  },
  duration:'23:41', speakerCount:3, translated:false
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onload = () => {
  buildWave();
  if(!apiKey) document.getElementById('key-modal').classList.add('show');
  if(!history.length) seedHistory();
  renderHistory();
  updateCvHints();
  window.speechSynthesis.onvoiceschanged = () => {};
};

function buildWave(){
  const w=document.getElementById('waveform');
  for(let i=0;i<20;i++){const b=document.createElement('div');b.className='wbar';b.style.cssText=`animation-delay:${i*.055}s;animation-duration:${.6+Math.random()*.8}s;`;w.appendChild(b);}
}
function seedHistory(){
  history=[
    {title:'à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸—à¸µà¸¡à¸‚à¸²à¸¢ Q4',duration:'23:41',date:'à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™',icon:'ğŸ’¼',speakers:3,data:DEMO},
    {title:'One-on-one à¸¥à¸¹à¸à¸„à¹‰à¸² VIP',duration:'15:20',date:'2 à¸§à¸±à¸™à¸à¹ˆà¸­à¸™',icon:'ğŸ¤',speakers:2,data:null},
    {title:'à¸ªà¸£à¸¸à¸› YouTube: Marketing 2025',duration:'--:--',date:'3 à¸§à¸±à¸™à¸à¹ˆà¸­à¸™',icon:'â–¶ï¸',speakers:1,data:null},
  ];
  saveHistory();
}
function saveHistory(){ localStorage.setItem('nai_hist',JSON.stringify(history)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAV & MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goPage(p){
  document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active'));
  document.querySelectorAll('.bnav-item').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  document.getElementById('bn-'+p).classList.add('active');
  if(p==='history') renderHistory();
}

function setMode(mode, btn){
  currentMode=mode;
  document.querySelectorAll('.modebt').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('upload-zone').style.display='none';
  document.getElementById('yt-zone').classList.remove('show');
  document.getElementById('tl-bar').classList.remove('show');
  document.getElementById('rec-hero').style.display='flex';
  document.getElementById('live-box').classList.remove('show');
  document.getElementById('file-prev').classList.remove('show');
  if(mode==='rec'){
    document.getElementById('rec-label').textContent='à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸šà¸±à¸™à¸—à¸¶à¸';
  } else if(mode==='file'){
    document.getElementById('rec-hero').style.display='none';
    document.getElementById('upload-zone').style.display='block';
  } else if(mode==='yt'){
    document.getElementById('rec-hero').style.display='none';
    document.getElementById('yt-zone').classList.add('show');
    document.getElementById('ps1n').textContent='à¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡';
    document.getElementById('ps3n').textContent='GPT-4o à¸ªà¸£à¸¸à¸› + à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ';
  } else if(mode==='tl'){
    document.getElementById('tl-bar').classList.add('show');
    document.getElementById('rec-label').textContent='à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¹à¸›à¸¥à¸ªà¸”';
  }
}

function setYtTab(tab, btn){
  document.querySelectorAll('.yt-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('yt-text-pane').style.display=tab==='text'?'block':'none';
  document.getElementById('yt-url-pane').style.display=tab==='url'?'block':'none';
}
function swapTlLangs(){const a=document.getElementById('tl-src'),b=document.getElementById('tl-dst');const t=a.value;a.value=b.value;b.value=t;showToast('à¸ªà¸¥à¸±à¸šà¸ à¸²à¸©à¸²à¹à¸¥à¹‰à¸§');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RECORDING (Record page)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let liveDemoIdx=0;
const LIVE_DEMO=['à¸à¸³à¸¥à¸±à¸‡à¸Ÿà¸±à¸‡à¹€à¸ªà¸µà¸¢à¸‡â€¦','à¸¢à¸­à¸”à¸‚à¸²à¸¢à¹€à¸”à¸·à¸­à¸™à¸™à¸µà¹‰à¹€à¸à¸´à¹ˆà¸¡ 15%â€¦','à¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸«à¸¡à¹ˆ 23 à¸£à¸²à¸¢â€¦','à¹€à¸›à¹‰à¸² Q4 à¸„à¸·à¸­ 8 à¸¥à¹‰à¸²à¸™à¸šà¸²à¸—â€¦','Facebook Ads Conversion 4.2%â€¦'];

async function toggleRec(){
  if(!isRec) await startRec(); else stopRec();
}
async function startRec(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    mr=new MediaRecorder(stream); chunks=[];
    mr.ondataavailable=e=>chunks.push(e.data);
    mr.onstop=()=>processAudio(new Blob(chunks,{type:'audio/webm'}));
    mr.start(); isRec=true; recSecs=0; liveDemoIdx=0;
    document.getElementById('rec-btn').classList.add('rec');
    document.getElementById('rec-btn').textContent='â¹ï¸';
    document.getElementById('rec-label').textContent=currentMode==='tl'?'à¸à¸³à¸¥à¸±à¸‡à¹à¸›à¸¥à¸ªà¸”â€¦':'à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸â€¦';
    document.getElementById('waveform').classList.add('show');
    document.getElementById('rec-timer').classList.add('live');
    document.getElementById('result-wrap').classList.remove('show');
    document.getElementById('live-box').classList.add('show');
    document.getElementById('lt-text').innerHTML='à¸à¸³à¸¥à¸±à¸‡à¸Ÿà¸±à¸‡â€¦<span class="cursor"></span>';
    timerInt=setInterval(()=>{
      recSecs++;
      const m=String(Math.floor(recSecs/60)).padStart(2,'0'),s=String(recSecs%60).padStart(2,'0');
      document.getElementById('rec-timer').textContent=`${m}:${s}`;
      if(recSecs%6===0) addLiveLine();
    },1000);
  }catch(e){showToast('à¸à¸£à¸¸à¸“à¸²à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸Šà¹‰à¹„à¸¡à¹‚à¸„à¸£à¹‚à¸Ÿà¸™');}
}
function addLiveLine(){
  const line=LIVE_DEMO[liveDemoIdx%LIVE_DEMO.length]; liveDemoIdx++;
  const el=document.getElementById('lt-text');
  if(el){ const lines=el.innerText.replace('<span class="cursor"></span>','').split('\n').filter(Boolean);lines.push(line);const last=lines.slice(-3);el.innerHTML=last.join('<br>')+'<span class="cursor"></span>'; }
}
function stopRec(){
  if(mr){mr.stop();mr.stream.getTracks().forEach(t=>t.stop());}
  clearInterval(timerInt); isRec=false;
  document.getElementById('rec-btn').classList.remove('rec');
  document.getElementById('rec-btn').textContent='ğŸ™ï¸';
  document.getElementById('rec-label').textContent='à¸à¸³à¸¥à¸±à¸‡à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥â€¦';
  document.getElementById('waveform').classList.remove('show');
  document.getElementById('rec-timer').classList.remove('live');
}

// File handling
function handleFile(e){const f=e.target.files[0];if(f)previewFile(f);}
function handleDrop(e){e.preventDefault();document.getElementById('upload-zone').classList.remove('over');const f=e.dataTransfer.files[0];if(f)previewFile(f);}
function previewFile(f){selectedFile=f;document.getElementById('file-name').textContent=f.name;document.getElementById('file-size').textContent=(f.size/1024/1024).toFixed(2)+' MB';document.getElementById('file-prev').classList.add('show');}
function clearFile(){selectedFile=null;document.getElementById('file-inp').value='';document.getElementById('file-prev').classList.remove('show');}
function processFile(){if(!selectedFile)return;document.getElementById('file-prev').classList.remove('show');processAudio(selectedFile);}

// Text / YouTube transcript
async function processText(){
  const text=document.getElementById('yt-text').value.trim();
  if(!text){showToast('à¸à¸£à¸¸à¸“à¸²à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸à¹ˆà¸­à¸™');return;}
  document.getElementById('yt-zone').classList.remove('show');
  showProc();
  if(!apiKey){
    for(const id of['ps1','ps2','ps3','ps4']){document.getElementById(id).classList.add('active');await sleep(700+Math.random()*500);doneStep(id);}
    currentResult={...DEMO,duration:'--:--',source:'text'};renderResult(currentResult);return;
  }
  try{
    doneStep2('ps1'); document.getElementById('ps2').classList.add('active'); await sleep(200);
    doneStep2('ps2'); document.getElementById('ps3').classList.add('active');
    const r=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`,'Content-Type':'application/json'},
      body:JSON.stringify({model:'gpt-4o',messages:[{role:'user',content:`à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸™à¸µà¹‰à¹à¸¥à¹‰à¸§à¸•à¸­à¸š JSON à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ à¹„à¸¡à¹ˆà¸¡à¸µ markdown:\n{"speakers":[{"id":"S1","name":"à¸œà¸¹à¹‰à¸à¸¹à¸” 1","color":"#4f8ef7","lines":["..."]}],"summary":{"overview":"...","points":["..."],"decisions":"...","detail":["..."]},"actions":[{"text":"...","assign":"...","pri":"h","subtasks":["..."]}],"mindmap":{"center":"à¸«à¸±à¸§à¸‚à¹‰à¸­à¸«à¸¥à¸±à¸","branches":[{"label":"1. à¸«à¸±à¸§à¸‚à¹‰à¸­","color":"#c0392b","subs":[{"label":"à¸ªà¸£à¸¸à¸›","color":"#27ae60","details":["..."]}]}]},"speakerCount":1}\n\nà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡:\n${text.slice(0,6000)}`}]})});
    const d=await r.json(); let result=DEMO;
    try{result={...JSON.parse(d.choices[0].message.content.replace(/```json|```/g,'').trim()),duration:'--:--'};}catch(e){}
    doneStep2('ps3'); document.getElementById('ps4').classList.add('active'); await sleep(400); doneStep2('ps4');
    currentResult=result; renderResult(result);
  }catch(e){showToast('Error: '+e.message);document.getElementById('proc-card').classList.remove('show');document.getElementById('yt-zone').classList.add('show');}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROCESS AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function processAudio(blob){
  const dur=document.getElementById('rec-timer').textContent||'00:00';
  showProc();
  document.getElementById('live-box').classList.remove('show');
  const isTl=currentMode==='tl';
  const src=document.getElementById('tl-src').value;
  const dst=document.getElementById('tl-dst').value;

  if(!apiKey){
    for(const id of['ps1','ps2','ps3','ps4']){document.getElementById(id).classList.add('active');await sleep(900+Math.random()*500);doneStep(id);}
    currentResult={...DEMO,duration:dur,translated:isTl,srcLang:src,dstLang:dst};renderResult(currentResult);return;
  }
  try{
    document.getElementById('ps1').classList.add('active');
    const fd=new FormData();fd.append('file',blob,'audio.webm');fd.append('model','whisper-1');fd.append('language',src);fd.append('response_format','verbose_json');
    await sleep(200);
    doneStep2('ps1'); document.getElementById('ps2').classList.add('active');
    const r1=await fetch('https://api.openai.com/v1/audio/transcriptions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`},body:fd});
    const d1=await r1.json(); const rawText=d1.text||'';
    doneStep2('ps2'); document.getElementById('ps3').classList.add('active');
    const transPrompt=isTl?`\nTranslate each speaker's lines to ${LANG_NAME[dst]} and include as "lines_trans" array.`:'';
    const r2=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`,'Content-Type':'application/json'},
      body:JSON.stringify({model:'gpt-4o',messages:[{role:'user',content:`à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹à¸¥à¹‰à¸§à¸•à¸­à¸š JSON à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ à¹„à¸¡à¹ˆà¸¡à¸µ markdown:\n{"speakers":[{"id":"S1","name":"à¸œà¸¹à¹‰à¸à¸¹à¸” 1","color":"#4f8ef7","lines":["..."],"lines_trans":["..."]}],"summary":{"overview":"...","points":["..."],"decisions":"...","detail":["..."]},"actions":[{"text":"...","assign":"...","pri":"h","subtasks":["..."]}],"mindmap":{"center":"à¸«à¸±à¸§à¸‚à¹‰à¸­à¸«à¸¥à¸±à¸","branches":[{"label":"1. à¸«à¸±à¸§à¸‚à¹‰à¸­","color":"#c0392b","subs":[{"label":"à¸ªà¸£à¸¸à¸›","color":"#27ae60","details":["..."]}]}]},"speakerCount":1}${transPrompt}\nà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡: ${rawText}`}]})});
    const d2=await r2.json(); let result=DEMO;
    try{result={...JSON.parse(d2.choices[0].message.content.replace(/```json|```/g,'').trim()),duration:dur,translated:isTl,srcLang:src,dstLang:dst};}catch(e){}
    doneStep2('ps3'); document.getElementById('ps4').classList.add('active'); await sleep(400); doneStep2('ps4');
    currentResult=result; renderResult(result);
  }catch(e){showToast('Error: '+e.message);document.getElementById('proc-card').classList.remove('show');document.getElementById('rec-label').textContent='à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸šà¸±à¸™à¸—à¸¶à¸';}
}

function showProc(){document.getElementById('proc-card').classList.add('show');document.getElementById('result-wrap').classList.remove('show');['ps1','ps2','ps3','ps4'].forEach(id=>{const el=document.getElementById(id);el.classList.remove('active','done');el.querySelector('.pstep-ic').textContent=id==='ps1'?'ğŸ“¤':id==='ps2'?'âœï¸':id==='ps3'?'ğŸ§ ':'ğŸ“Š';});}
function doneStep(id){document.getElementById(id).classList.add('active');return;}
function doneStep2(id){const el=document.getElementById(id);el.classList.remove('active');el.classList.add('done');el.querySelector('.pstep-ic').textContent='âœ…';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER RESULT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderResult(d){
  document.getElementById('proc-card').classList.remove('show');
  document.getElementById('result-wrap').classList.add('show');
  document.getElementById('rec-label').textContent='à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§ âœ“';
  document.getElementById('chip-dur').textContent=d.duration||'--:--';
  document.getElementById('chip-spk').textContent=(d.speakerCount||d.speakers?.length||1)+' à¸„à¸™';
  const cl=document.getElementById('chip-lang');
  const lt=document.getElementById('lang-toggle');
  if(d.translated){cl.style.display='block';cl.textContent=`${LANG_FLAG[d.srcLang]}â†’${LANG_FLAG[d.dstLang]}`;lt.style.display='flex';}
  else{cl.style.display='none';lt.style.display='none';}
  renderTranscript(d);
  if(d.summary){
    document.getElementById('sum-overview').textContent=d.summary.overview||'';
    document.getElementById('sum-pts').innerHTML=(d.summary.points||[]).map(p=>`<div class="sum-pt"><span style="color:var(--blue);flex-shrink:0">â–¸</span>${p}</div>`).join('');
    document.getElementById('sum-dec').textContent=d.summary.decisions||'';
    document.getElementById('sum-det').innerHTML=(d.summary.detail||[]).map(p=>`<div class="sum-pt"><span style="color:var(--text3);flex-shrink:0">Â·</span>${p}</div>`).join('');
    setDetail('mid',document.querySelector('.dl-btn.active'));
  }
  renderActions(d.actions||[]);
  if(d.mindmap){
    mmData=JSON.parse(JSON.stringify(d.mindmap));
    if(d.speakers)syncSpeakers(d.speakers);
    mmOpen=new Set();mmDetOpen=new Set();
    mmData.branches.forEach((b,i)=>{mmOpen.add(i);if(b.subs)b.subs.forEach((_,j)=>mmDetOpen.add(`${i}-${j}`));});
    renderMindMap();
  }
  history.unshift({title:'à¸›à¸£à¸°à¸Šà¸¸à¸¡ '+new Date().toLocaleDateString('th-TH',{day:'numeric',month:'short'}),duration:d.duration||'--:--',date:'à¹€à¸¡à¸·à¹ˆà¸­à¸à¸µà¹‰',icon:currentMode==='yt'?'â–¶ï¸':'ğŸ™ï¸',speakers:d.speakerCount||1,data:d});
  if(history.length>30)history.pop();
  saveHistory(); renderHistory();
}

// â”€â”€ Transcript â”€â”€
function renderTranscript(d){
  const tc=document.getElementById('transcript-content');
  const note=document.getElementById('trs-note');
  if(!d||!d.speakers){tc.innerHTML='';return;}
  note.textContent=d.translated?`${LANG_FLAG[d.srcLang]}â†’${LANG_FLAG[d.dstLang]}`:'';
  tc.innerHTML=d.speakers.map((sp,i)=>`
    <div class="spk-block">
      <div class="spk-label" onclick="openRename(${i})">
        <div class="spk-dot" style="background:${sp.color||'#4f8ef7'}"></div>
        <span id="spk-nm-${i}">${sp.name||sp.id}</span>
        <span style="font-size:10px;color:var(--text3);margin-left:2px">âœï¸</span>
      </div>
      ${(sp.lines||[]).map((l,li)=>`
        <div class="spk-text" style="${showLangMode==='trans'?'display:none':''}">${l}</div>
        ${sp.lines_trans?.[li]?`<div class="spk-text-tr ${showLangMode!=='orig'?'show':''}">${sp.lines_trans[li]}</div>`:''}`).join('')}
    </div>`).join('');
}
function showLang(m){
  showLangMode=m;
  ['orig','trans','both'].forEach(x=>document.getElementById('ltb-'+x).classList.remove('active'));
  document.getElementById('ltb-'+m).classList.add('active');
  if(currentResult)renderTranscript(currentResult);
}

// â”€â”€ Actions â”€â”€
function renderActions(actions){
  document.getElementById('action-list').innerHTML=actions.map((a,i)=>{
    const pi=a.pri==='h'?'pri-h':a.pri==='m'?'pri-m':'pri-l';
    const pt=a.pri==='h'?'ğŸ”´ à¸ªà¸¹à¸‡':a.pri==='m'?'ğŸŸ¡ à¸à¸¥à¸²à¸‡':'ğŸŸ¢ à¸•à¹ˆà¸³';
    const subs=a.subtasks||[];
    const sub=subs.length?`<div class="sub-toggle" onclick="toggleSub(${i})">â–¸ ${subs.length} à¸‡à¸²à¸™à¸¢à¹ˆà¸­à¸¢</div>
      <div class="sub-list" id="sub-${i}" style="display:none">
        ${subs.map((s,j)=>`<div class="sub-row"><div class="scb" id="scb-${i}-${j}" onclick="toggleScb(this,${i},${j})"></div><span class="s-txt" id="stxt-${i}-${j}">${s}</span></div>`).join('')}</div>`:'';
    return `<li class="action-row">
      <div class="acb" id="ac${i}" onclick="toggleAc(this,${i})"></div>
      <div class="ac-content">
        <div class="ac-txt" id="at${i}">${a.text||a}</div>
        <div class="ac-meta">${a.assign?`<span class="ac-who">ğŸ‘¤ ${a.assign}</span>`:''}<span class="${pi}">${pt}</span></div>
        ${sub}
      </div></li>`;
  }).join('');
  updateAcCount(actions);
}
function updateAcCount(a){const done=a.filter((_,i)=>document.getElementById('ac'+i)?.classList.contains('done')).length;const el=document.getElementById('ac-count');if(el)el.textContent=`${done}/${a.length} à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§`;}
function toggleAc(cb,i){cb.classList.toggle('done');document.getElementById('at'+i).classList.toggle('done');cb.textContent=cb.classList.contains('done')?'âœ“':'';if(currentResult)updateAcCount(currentResult.actions||[]);}
function toggleSub(i){const el=document.getElementById('sub-'+i);const bt=el.previousElementSibling;if(el.style.display==='none'){el.style.display='flex';bt.textContent=`â–¾ ${el.children.length} à¸‡à¸²à¸™à¸¢à¹ˆà¸­à¸¢`;}else{el.style.display='none';bt.textContent=`â–¸ ${el.children.length} à¸‡à¸²à¸™à¸¢à¹ˆà¸­à¸¢`;}}
function toggleScb(cb,i,j){cb.classList.toggle('done');document.getElementById('stxt-'+i+'-'+j).classList.toggle('done');cb.textContent=cb.classList.contains('done')?'âœ“':'';}

// â”€â”€ Summary detail level â”€â”€
function setDetail(lv,btn){
  document.querySelectorAll('.dl-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  document.getElementById('sum-pts-blk').style.display=lv==='low'?'none':'block';
  document.getElementById('sum-dec-blk').style.display='block';
  document.getElementById('sum-det-blk').style.display=lv==='high'?'block':'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MIND MAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ROW=24,CX=140,BX=230,SX=390,DX=525,DOT=5.5,SDOT=5,FS=11.5,FS2=10.5,FS3=10;
function charW(fs){return fs*.58;} function tW(s,fs){return s.length*charW(fs);}
function syncSpeakers(sps){sps.forEach(sp=>{mmData.branches.forEach(b=>{if(b.subs)b.subs.forEach(s=>{if(s.details)s.details=s.details.map(d=>d.replace(new RegExp(`\\[${sp.id}\\]`,'g'),`[${sp.name}]`));});});});}

function renderMindMap(){
  const svgEl=document.getElementById('mm-svg');
  if(!svgEl||!mmData)return;
  svgEl.innerHTML=''; mmG=mkEl('g'); svgEl.appendChild(mmG);
  const rows=[];
  mmData.branches.forEach((b,i)=>{
    rows.push({kind:'b',b,i});
    if(mmOpen.has(i)&&b.subs) b.subs.forEach((s,j)=>{rows.push({kind:'s',b,i,s,j});const key=`${i}-${j}`;if(mmDetOpen.has(key)&&s.details)s.details.forEach((d,k)=>rows.push({kind:'d',d,i,j,k}));});
  });
  rows.forEach((r,idx)=>r.y=idx*ROW+ROW/2+4);
  const bRows=rows.filter(r=>r.kind==='b');
  const cy0=bRows[0]?.y??80,cy1=bRows[bRows.length-1]?.y??80,CY=(cy0+cy1)/2;
  drawMMCenter(CY);
  bRows.forEach(r=>bezier(mmG,CX,CY,BX-DOT-1,r.y,r.b.color,1.3,.5));
  rows.forEach(r=>{if(r.kind==='b')drawBranch(r);if(r.kind==='s')drawSub(r);if(r.kind==='d')drawDet(r);});
  rows.filter(r=>r.kind==='b'&&mmOpen.has(r.i)&&r.b.subs).forEach(r=>{const ex=BX+10+tW(r.b.label,FS)+14;rows.filter(s=>s.kind==='s'&&s.i===r.i).forEach(s=>bezier(mmG,ex,r.y,SX-SDOT-1,s.y,r.b.color,1,.45));});
  rows.filter(r=>r.kind==='s').forEach(r=>{const key=`${r.i}-${r.j}`;if(!mmDetOpen.has(key))return;const ex=SX+9+tW(r.s.label,FS2)+13;rows.filter(d=>d.kind==='d'&&d.i===r.i&&d.j===r.j).forEach(d=>bezier(mmG,ex,r.y,DX-6,d.y,'#c8c8c8',.8,.42));});
  svgEl.setAttribute('width','860');svgEl.setAttribute('height',Math.max(rows.length*ROW+20,280));
  applyMM();
}
function drawMMCenter(cy){const bw=116,bh=28;mmG.appendChild(mkEl('polygon',{points:`0,${cy-10} 12,${cy-10} 12,${cy+10} 0,${cy+10} 8,${cy}`,fill:'#d0d0d0'}));mmG.appendChild(mkEl('rect',{x:12,y:cy-bh/2,width:bw,height:bh,rx:8,fill:'#2d2d2d'}));const tx=mkEl('text',{x:12+bw/2,y:cy+.5,'text-anchor':'middle','dominant-baseline':'middle',fill:'#fff','font-size':'10','font-weight':'600','font-family':'Inter,Sarabun,sans-serif'});const lbl=mmData.center||'à¸«à¸±à¸§à¸‚à¹‰à¸­';tx.textContent=lbl.length>14?lbl.slice(0,13)+'â€¦':lbl;mmG.appendChild(tx);}
function drawBranch(r){const g=mkEl('g');g.style.cursor='pointer';g.appendChild(mkEl('circle',{cx:BX,cy:r.y,r:DOT+1.5,fill:r.b.color,'fill-opacity':'.18'}));g.appendChild(mkEl('circle',{cx:BX,cy:r.y,r:DOT,fill:r.b.color}));const tx=mkEl('text',{x:BX+10,y:r.y+.5,'dominant-baseline':'middle',fill:'#222','font-size':FS,'font-family':'Inter,Sarabun,sans-serif','font-weight':mmOpen.has(r.i)?'600':'400'});tx.textContent=r.b.label;g.appendChild(tx);if(r.b.subs){const ax=BX+10+tW(r.b.label,FS)+6;const ar=mkEl('text',{x:ax,y:r.y+.5,'dominant-baseline':'middle',fill:'#aaa','font-size':'9','font-family':'Inter,sans-serif'});ar.textContent=mmOpen.has(r.i)?'â–¾':'â–¸';g.appendChild(ar);}g.addEventListener('click',()=>{mmOpen.has(r.i)?mmOpen.delete(r.i):mmOpen.add(r.i);renderMindMap();});mmG.appendChild(g);}
function drawSub(r){const g=mkEl('g');g.style.cursor='pointer';const key=`${r.i}-${r.j}`;g.appendChild(mkEl('circle',{cx:SX,cy:r.y,r:SDOT,fill:r.s.color||'#333'}));const tx=mkEl('text',{x:SX+9,y:r.y+.5,'dominant-baseline':'middle',fill:'#444','font-size':FS2,'font-family':'Inter,Sarabun,sans-serif','font-weight':mmDetOpen.has(key)?'600':'400'});tx.textContent=r.s.label;g.appendChild(tx);if(r.s.details){const ax=SX+9+tW(r.s.label,FS2)+5;const ar=mkEl('text',{x:ax,y:r.y+.5,'dominant-baseline':'middle',fill:'#aaa','font-size':'9','font-family':'Inter,sans-serif'});ar.textContent=mmDetOpen.has(key)?'â–¾':'â–¸';g.appendChild(ar);}g.addEventListener('click',()=>{mmDetOpen.has(key)?mmDetOpen.delete(key):mmDetOpen.add(key);renderMindMap();});mmG.appendChild(g);}
function drawDet(r){mmG.appendChild(mkEl('circle',{cx:DX-1,cy:r.y,r:2.5,fill:'#bbb'}));const tx=mkEl('text',{x:DX+7,y:r.y+.5,'dominant-baseline':'middle',fill:'#555','font-size':FS3,'font-family':'Inter,Sarabun,sans-serif','font-weight':'300'});tx.textContent=r.d;mmG.appendChild(tx);}
function bezier(parent,x1,y1,x2,y2,color,sw,t){const mx=x1+(x2-x1)*(t||.5);parent.appendChild(mkEl('path',{d:`M${x1},${y1} C${mx},${y1} ${mx},${y2} ${x2},${y2}`,fill:'none',stroke:color,'stroke-width':sw||1,'stroke-opacity':'.5','stroke-linecap':'round'}));}
function mkEl(tag,attrs={}){const e=document.createElementNS(NS,tag);Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v));return e;}
function applyMM(){if(mmG)mmG.setAttribute('transform',`translate(${mmOx},${mmOy}) scale(${mmScale})`);}
function mmZoom(d){mmScale=Math.max(.3,Math.min(3,mmScale+d));applyMM();}
function mmReset(){mmScale=1;mmOx=8;mmOy=8;applyMM();}
function mmExpandAll(){if(!mmData)return;mmData.branches.forEach((b,i)=>{mmOpen.add(i);if(b.subs)b.subs.forEach((_,j)=>mmDetOpen.add(`${i}-${j}`));});renderMindMap();}
function mmCollapseAll(){mmOpen=new Set();mmDetOpen=new Set();renderMindMap();}

// MM touch/drag
const mmCv=document.getElementById('mm-canvas');
if(mmCv){
  mmCv.addEventListener('mousedown',e=>{mmDrag=true;mmPx=e.clientX-mmOx;mmPy=e.clientY-mmOy;mmCv.classList.add('grabbing');});
  window.addEventListener('mousemove',e=>{if(!mmDrag)return;mmOx=e.clientX-mmPx;mmOy=e.clientY-mmPy;applyMM();});
  window.addEventListener('mouseup',()=>{mmDrag=false;if(mmCv)mmCv.classList.remove('grabbing');});
  mmCv.addEventListener('wheel',e=>{e.preventDefault();mmZoom(e.deltaY<0?.1:-.1);},{passive:false});
  let mmTd=0;
  mmCv.addEventListener('touchstart',e=>{e.stopPropagation();if(e.touches.length===1){mmDrag=true;mmPx=e.touches[0].clientX-mmOx;mmPy=e.touches[0].clientY-mmOy;}if(e.touches.length===2)mmTd=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);},{passive:false});
  mmCv.addEventListener('touchmove',e=>{e.preventDefault();e.stopPropagation();if(mmDrag&&e.touches.length===1){mmOx=e.touches[0].clientX-mmPx;mmOy=e.touches[0].clientY-mmPy;applyMM();}if(e.touches.length===2){const nd=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY);mmScale=Math.max(.3,Math.min(3,mmScale*(nd/mmTd)));mmTd=nd;applyMM();}},{passive:false});
  mmCv.addEventListener('touchend',e=>{e.stopPropagation();mmDrag=false;},{passive:false});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SPEAKER RENAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openRename(idx){
  if(!currentResult||!currentResult.speakers)return;
  renameIdx=idx; const sp=currentResult.speakers[idx];
  document.getElementById('rename-inp').value=sp.name||sp.id||'';
  document.getElementById('rename-sub').textContent=`à¸œà¸¹à¹‰à¸à¸¹à¸”à¸„à¸™à¸—à¸µà¹ˆ ${idx+1}`;
  document.getElementById('color-row').innerHTML=SPK_COLORS.map(c=>`<div class="color-dot ${sp.color===c?'selected':''}" style="background:${c}" onclick="selColor(this,'${c}')"></div>`).join('');
  document.getElementById('rename-modal').classList.add('show');
  setTimeout(()=>document.getElementById('rename-inp').focus(),200);
}
function selColor(el,c){document.querySelectorAll('.color-dot').forEach(d=>d.classList.remove('selected'));el.classList.add('selected');if(currentResult?.speakers&&renameIdx>=0)currentResult.speakers[renameIdx].color=c;}
function saveRename(){
  if(renameIdx<0||!currentResult?.speakers)return;
  const newName=document.getElementById('rename-inp').value.trim();
  if(!newName){showToast('à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­');return;}
  const sp=currentResult.speakers[renameIdx]; const oldName=sp.name,oldId=sp.id;
  sp.name=newName;
  currentResult.actions?.forEach(a=>{if(a.assign&&(a.assign.includes(oldName)||a.assign.includes(oldId)))a.assign=a.assign.replace(oldName,newName).replace(oldId,newName);});
  if(mmData){mmData.branches.forEach(b=>{if(b.subs)b.subs.forEach(s=>{if(s.details)s.details=s.details.map(d=>d.replace(new RegExp(`\\[${oldName}\\]`,'g'),`[${newName}]`).replace(new RegExp(`\\[${oldId}\\]`,'g'),`[${newName}]`));});});renderMindMap();}
  renderTranscript(currentResult); renderActions(currentResult.actions||[]);
  closeRename(); showToast(`âœ… à¸­à¸±à¸›à¹€à¸”à¸• "${newName}" à¸—à¸¸à¸à¸—à¸µà¹ˆ`);
}
function closeRename(){document.getElementById('rename-modal').classList.remove('show');renameIdx=-1;}
document.getElementById('rename-modal')?.addEventListener('click',function(e){if(e.target===this)closeRename();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TRANSLATE PAGE (tl2)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function swapTl2(){const a=document.getElementById('tl2-src'),b=document.getElementById('tl2-dst');const t=a.value;a.value=b.value;b.value=t;showToast('à¸ªà¸¥à¸±à¸šà¸ à¸²à¸©à¸²');}

async function toggleTlRec(){
  if(tl2Rec&&tl2Rec.state==='recording'){stopTlRec();}
  else{await startTlRec();}
}
async function startTlRec(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    tl2Rec=new MediaRecorder(stream); tl2Chunks=[];
    tl2Rec.ondataavailable=e=>tl2Chunks.push(e.data);
    tl2Rec.onstop=()=>processTlAudio(new Blob(tl2Chunks,{type:'audio/webm'}));
    tl2Rec.start(); tl2Secs=0;
    document.getElementById('tl2-btn').classList.add('rec');
    document.getElementById('tl2-btn').textContent='â¹ï¸';
    document.getElementById('tl2-hint').textContent='à¸à¸³à¸¥à¸±à¸‡à¸Ÿà¸±à¸‡â€¦ à¸à¸”à¸«à¸¢à¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­à¸à¸¹à¸”à¹€à¸ªà¸£à¹‡à¸ˆ';
    document.getElementById('tl2-wv').classList.add('show');
    document.getElementById('tl2-timer').classList.add('show');
    tl2Timer=setInterval(()=>{tl2Secs++;const m=String(Math.floor(tl2Secs/60)).padStart(2,'0'),s=String(tl2Secs%60).padStart(2,'0');document.getElementById('tl2-timer').textContent=`${m}:${s}`;},1000);
  }catch(e){showToast('à¸à¸£à¸¸à¸“à¸²à¸­à¸™à¸¸à¸à¸²à¸•à¹„à¸¡à¹‚à¸„à¸£à¹‚à¸Ÿà¸™');}
}
function stopTlRec(){
  if(tl2Rec){tl2Rec.stop();tl2Rec.stream.getTracks().forEach(t=>t.stop());}
  clearInterval(tl2Timer);
  document.getElementById('tl2-btn').classList.remove('rec');
  document.getElementById('tl2-btn').textContent='â™ï¸';
  document.getElementById('tl2-hint').textContent='à¸à¸³à¸¥à¸±à¸‡à¹à¸›à¸¥â€¦';
  document.getElementById('tl2-wv').classList.remove('show');
  document.getElementById('tl2-timer').classList.remove('show');
}
async function processTlAudio(blob){
  const src=document.getElementById('tl2-src').value;
  const dst=document.getElementById('tl2-dst').value;
  if(!apiKey){
    await sleep(1000);
    const ph=DP[src]||DP['th'];
    const orig=ph[demoIdx.tl%ph.length];
    const key=`${src}-${dst}`;
    const ta=DT[key]||DT['th-en']||[];
    const trans=ta[demoIdx.tl%ta.length]||'[Demo translation]';
    demoIdx.tl++;
    showTl2Result(orig,trans,src,dst); return;
  }
  try{
    const fd=new FormData();fd.append('file',blob,'audio.webm');fd.append('model','whisper-1');fd.append('language',src);
    const r1=await fetch('https://api.openai.com/v1/audio/transcriptions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`},body:fd});
    const d1=await r1.json(); const origText=d1.text||'';
    if(!origText){showToast('à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸¢à¸´à¸™à¹€à¸ªà¸µà¸¢à¸‡');resetTl2Btn();return;}
    const r2=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`,'Content-Type':'application/json'},
      body:JSON.stringify({model:'gpt-4o',messages:[{role:'user',content:`Translate from ${LANG_NAME[src]} to ${LANG_NAME[dst]}. Reply with ONLY the translation:\n\n${origText}`}],max_tokens:400})});
    const d2=await r2.json(); const transText=d2.choices?.[0]?.message?.content?.trim()||'';
    showTl2Result(origText,transText,src,dst);
  }catch(e){showToast('Error: '+e.message);resetTl2Btn();}
}
function showTl2Result(orig,trans,src,dst){
  tl2CurOrig=orig; tl2CurTrans=trans; tl2CurDst=dst;
  document.getElementById('tl2-orig-text').textContent=orig;
  document.getElementById('tl2-trans-text').textContent=trans;
  document.getElementById('tl2-badge-orig').textContent=LANG_FLAG[src]+' '+LANG_NAME[src];
  document.getElementById('tl2-badge-dst').textContent=LANG_FLAG[dst]+' '+LANG_NAME[dst];
  document.getElementById('tl2-result').classList.add('show');
  resetTl2Btn();
  tl2History.unshift({orig,trans,src,dst,time:new Date().toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})});
  if(tl2History.length>8)tl2History.pop();
  renderTl2Hist();
  if(document.getElementById('tts-toggle')?.classList.contains('on')) setTimeout(()=>speakTl2Trans(),300);
}
function resetTl2Btn(){document.getElementById('tl2-btn').textContent='ğŸ™ï¸';document.getElementById('tl2-btn').classList.remove('rec');document.getElementById('tl2-hint').textContent='à¹à¸•à¸°à¹€à¸à¸·à¹ˆà¸­à¸à¸¹à¸” â†’ à¹à¸›à¸¥à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´';}
function renderTl2Hist(){
  const wrap=document.getElementById('tl2-hist-wrap');
  const list=document.getElementById('tl2-hist-list');
  if(!tl2History.length){wrap.style.display='none';return;}
  wrap.style.display='block';
  list.innerHTML=tl2History.map((h,i)=>`<div class="tl-hist-item" onclick="replayTl2(${i})"><div class="thi-orig">${h.orig}</div><div class="thi-trans">${h.trans}</div><div class="thi-meta">${LANG_FLAG[h.src]}â†’${LANG_FLAG[h.dst]} Â· ${h.time} Â· ğŸ”Š à¹à¸•à¸°à¸‹à¹‰à¸³</div></div>`).join('');
}
function replayTl2(i){const h=tl2History[i];showTl2Result(h.orig,h.trans,h.src,h.dst);}
function speakTl2Trans(){
  if(!tl2CurTrans)return;
  const btn=document.getElementById('tl2-speak-btn');
  btn.classList.add('playing'); btn.textContent='â¸ï¸ à¸à¸³à¸¥à¸±à¸‡à¸­à¹ˆà¸²à¸™â€¦';
  speakText(tl2CurTrans,tl2CurDst||document.getElementById('tl2-dst').value,()=>{btn.classList.remove('playing');btn.textContent='ğŸ”Š à¸­à¹ˆà¸²à¸™à¸„à¸³à¹à¸›à¸¥';});
}
function speakTl2Orig(){if(!tl2CurOrig)return;speakText(tl2CurOrig,document.getElementById('tl2-src').value,null);showToast('ğŸ—£ï¸ à¸­à¹ˆà¸²à¸™à¸•à¹‰à¸™à¸‰à¸šà¸±à¸š');}
function copyTl2(){if(!tl2CurTrans)return;navigator.clipboard.writeText(tl2CurTrans).then(()=>showToast('ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§'));}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONVERSATION PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateCvHints(){
  const la=document.getElementById('cv-lang-a').value;
  const lb=document.getElementById('cv-lang-b').value;
  document.getElementById('cv-hint-a').textContent=`${LANG_NAME[la]} â†’ ${LANG_NAME[lb]}`;
  document.getElementById('cv-hint-b').textContent=`${LANG_NAME[lb]} â†’ ${LANG_NAME[la]}`;
}
async function startCvRec(side){
  if(cvActiveSide===side&&cvRec?.state==='recording'){stopCvRec();return;}
  if(cvRec?.state==='recording'){stopCvRec();await sleep(300);}
  cvActiveSide=side;
  document.getElementById('cv-empty').style.display='none';
  document.getElementById('cv-btn-'+side).classList.add('rec');
  document.getElementById('card-'+side).classList.add('active-'+side);
  if(!apiKey){
    await sleep(1400);
    const la=document.getElementById('cv-lang-a').value;
    const lb=document.getElementById('cv-lang-b').value;
    const src=side==='a'?la:lb, dst=side==='a'?lb:la;
    const ph=DP[src]||DP['th'];
    const orig=ph[demoIdx[side]%ph.length];
    const key=`${src}-${dst}`;
    const ta=DT[key]||DT['th-en']||[];
    const trans=ta[demoIdx[side]%ta.length]||orig;
    demoIdx[side]++;
    document.getElementById('cv-btn-'+side).classList.remove('rec');
    document.getElementById('card-'+side).classList.remove('active-a','active-b');
    cvActiveSide=null;
    addCvBubble(side,orig,trans,src,dst); return;
  }
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    cvRec=new MediaRecorder(stream); cvChunks=[];
    cvRec.ondataavailable=e=>cvChunks.push(e.data);
    cvRec.onstop=()=>processCvAudio(side,new Blob(cvChunks,{type:'audio/webm'}));
    cvRec.start(); showToast(`ğŸ™ï¸ à¸„à¸™à¸—à¸µà¹ˆ ${side==='a'?1:2} à¸à¸³à¸¥à¸±à¸‡à¸à¸¹à¸”â€¦`);
  }catch(e){showToast('à¸à¸£à¸¸à¸“à¸²à¸­à¸™à¸¸à¸à¸²à¸•à¹„à¸¡à¹‚à¸„à¸£à¹‚à¸Ÿà¸™');document.getElementById('cv-btn-'+side).classList.remove('rec');}
}
function stopCvRec(){
  if(cvRec?.state==='recording'){cvRec.stop();cvRec.stream.getTracks().forEach(t=>t.stop());}
  if(cvActiveSide){document.getElementById('cv-btn-'+cvActiveSide).classList.remove('rec');document.getElementById('card-'+cvActiveSide).classList.remove('active-a','active-b');}
  cvActiveSide=null;
}
async function processCvAudio(side,blob){
  const la=document.getElementById('cv-lang-a').value;
  const lb=document.getElementById('cv-lang-b').value;
  const src=side==='a'?la:lb, dst=side==='a'?lb:la;
  try{
    const fd=new FormData();fd.append('file',blob,'audio.webm');fd.append('model','whisper-1');fd.append('language',src);
    const r1=await fetch('https://api.openai.com/v1/audio/transcriptions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`},body:fd});
    const d1=await r1.json(); const orig=d1.text||'';
    if(!orig){showToast('à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸¢à¸´à¸™à¹€à¸ªà¸µà¸¢à¸‡');return;}
    const r2=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`,'Content-Type':'application/json'},
      body:JSON.stringify({model:'gpt-4o',messages:[{role:'user',content:`Translate from ${LANG_NAME[src]} to ${LANG_NAME[dst]}. Reply ONLY the translation:\n\n${orig}`}],max_tokens:300})});
    const d2=await r2.json(); const trans=d2.choices?.[0]?.message?.content?.trim()||'';
    addCvBubble(side,orig,trans,src,dst);
  }catch(e){showToast('Error: '+e.message);}
}
function addCvBubble(side,orig,trans,src,dst){
  const feed=document.getElementById('cv-feed');
  const id='bub'+(++cvBubbles);
  const div=document.createElement('div');
  div.className=`bubble ${side}`; div.id=id;
  div.innerHTML=`<div class="bub-orig">${orig}</div><div class="bub-trans ${side}">${trans}</div><div class="bub-meta">${LANG_FLAG[src]}â†’${LANG_FLAG[dst]}<span class="spk-mini" onclick="speakBubble('${id}','${trans.replace(/'/g,"\\'")}','${dst}')">ğŸ”Š</span></div>`;
  feed.appendChild(div); feed.scrollTop=feed.scrollHeight;
  cvHistory.push({side,orig,trans,src,dst});
  if(document.getElementById('tts-toggle')?.classList.contains('on')) setTimeout(()=>speakBubble(id,trans,dst),300);
}
function speakBubble(id,text,lang){
  const b=document.getElementById(id);
  const sp=b?.querySelector('.spk-mini');
  if(sp)sp.textContent='â¸ï¸';
  speakText(text,lang,()=>{if(sp)sp.textContent='ğŸ”Š';});
}
function clearCv(){if(!confirm('à¸¥à¹‰à¸²à¸‡à¸šà¸—à¸ªà¸™à¸—à¸™à¸²?'))return;document.getElementById('cv-feed').innerHTML='<div class="cv-empty" id="cv-empty">à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸à¸¹à¸”<br>à¸£à¸°à¸šà¸šà¸ˆà¸°à¹à¸›à¸¥à¹ƒà¸«à¹‰à¸­à¸µà¸à¸à¹ˆà¸²à¸¢à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´<br>à¸à¸£à¹‰à¸­à¸¡à¸­à¹ˆà¸²à¸™à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡ ğŸ”Š</div>';cvHistory=[];cvBubbles=0;showToast('ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¹à¸¥à¹‰à¸§');}
function exportCv(){
  if(!cvHistory.length){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸—à¸ªà¸™à¸—à¸™à¸²');return;}
  const lines=['=== à¸šà¸—à¸ªà¸™à¸—à¸™à¸² NoteAI ===\n'];
  cvHistory.forEach(h=>lines.push(`[à¸„à¸™à¸—à¸µà¹ˆ${h.side==='a'?1:2}] ${LANG_FLAG[h.src]} ${h.orig}\n  â†’ ${LANG_FLAG[h.dst]} ${h.trans}\n`));
  const blob=new Blob([lines.join('\n')],{type:'text/plain;charset=utf-8'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');a.href=url;a.download='à¸ªà¸™à¸—à¸™à¸²_'+Date.now()+'.txt';a.click();showToast('ğŸ“„ Export à¹à¸¥à¹‰à¸§');
}
function shareCv(){
  if(!cvHistory.length){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸—à¸ªà¸™à¸—à¸™à¸²');return;}
  const t=cvHistory.map(h=>`[${h.side==='a'?'à¸„à¸™à¸—à¸µà¹ˆ1':'à¸„à¸™à¸—à¸µà¹ˆ2'}] ${h.orig} â†’ ${h.trans}`).join('\n');
  if(navigator.share)navigator.share({title:'à¸šà¸—à¸ªà¸™à¸—à¸™à¸² NoteAI',text:t});
  else navigator.clipboard.writeText(t).then(()=>showToast('ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function speakText(text,lang,onEnd){
  if(!window.speechSynthesis){showToast('à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š TTS');return;}
  window.speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang=TTS_CODE[lang]||'th-TH'; u.rate=.95; u.pitch=1;
  const voices=window.speechSynthesis.getVoices();
  const match=voices.find(v=>v.lang.startsWith((TTS_CODE[lang]||'th-TH').split('-')[0]));
  if(match)u.voice=match;
  u.onend=()=>{if(onEnd)onEnd();};
  window.speechSynthesis.speak(u);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHistory(){
  const list=document.getElementById('hist-list');
  if(!list)return;
  list.innerHTML=history.map((h,i)=>`<div class="hist-item" onclick="loadHistory(${i})"><div class="hi-ic">${h.icon||'ğŸ™ï¸'}</div><div class="hi-info"><div class="hi-title">${h.title}</div><div class="hi-meta"><span class="hi-tag">â±ï¸ ${h.duration}</span><span class="hi-tag">ğŸ‘¥ ${h.speakers||1} à¸„à¸™</span><span class="hi-tag">${h.date}</span></div></div><div class="hi-arr">â€º</div></div>`).join('')||'<div style="padding:40px;text-align:center;color:var(--text2)">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´</div>';
}
function loadHistory(i){const item=history[i];if(item?.data){currentResult=item.data;goPage('record');renderResult(currentResult);showToast('à¹‚à¸«à¸¥à¸”: '+item.title);}else showToast('à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportTXT(){
  if(!currentResult){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ');return;}
  const lines=['=== NoteAI ===\n'];
  if(currentResult.summary){lines.push('à¸ªà¸£à¸¸à¸›: '+currentResult.summary.overview);lines.push('\nà¸›à¸£à¸°à¹€à¸”à¹‡à¸™:');(currentResult.summary.points||[]).forEach(p=>lines.push('â€¢ '+p));lines.push('\nà¸‚à¹‰à¸­à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ: '+currentResult.summary.decisions);}
  lines.push('\n=== Action Items ===');
  (currentResult.actions||[]).forEach(a=>lines.push('â˜ '+(a.text||a)+' ('+( a.assign||'')+')'));
  const blob=new Blob([lines.join('\n')],{type:'text/plain;charset=utf-8'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='NoteAI_'+Date.now()+'.txt';a.click();showToast('ğŸ“„ TXT');
}
function exportJSON(){if(!currentResult){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ');return;}const blob=new Blob([JSON.stringify(currentResult,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='NoteAI_'+Date.now()+'.json';a.click();showToast('ğŸ“¦ JSON');}
function copyAll(){if(!currentResult?.summary){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ');return;}const t=`à¸ªà¸£à¸¸à¸›: ${currentResult.summary.overview}\n\nAction Items:\n${(currentResult.actions||[]).map(a=>'â€¢ '+(a.text||a)).join('\n')}`;navigator.clipboard.writeText(t).then(()=>showToast('ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§ âœ“'));}
function shareResult(){if(!currentResult){showToast('à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ');return;}if(navigator.share&&currentResult?.summary)navigator.share({title:'NoteAI',text:currentResult.summary.overview});else copyAll();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  API KEY / SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showKeyModal(){document.getElementById('key-modal').classList.add('show');}
function saveKeyModal(){const k=document.getElementById('m-key').value.trim();if(k){apiKey=k;localStorage.setItem('nai_key',k);document.getElementById('s-key').value=k;}document.getElementById('key-modal').classList.remove('show');document.getElementById('demo-banner').classList.remove('show');showToast(k?'âœ… à¸šà¸±à¸™à¸—à¸¶à¸ API Key':'à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸ªà¹ˆ Key');}
function demoMode(){document.getElementById('key-modal').classList.remove('show');document.getElementById('demo-banner').classList.add('show');showToast('ğŸ­ à¹‚à¸«à¸¡à¸” Demo');}
function saveKey(){const k=document.getElementById('s-key').value.trim();if(k){apiKey=k;localStorage.setItem('nai_key',k);showToast('âœ… à¸šà¸±à¸™à¸—à¸¶à¸ API Key');}else showToast('à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆ API Key');}
document.getElementById('key-modal')?.addEventListener('click',function(e){if(e.target===this)this.classList.remove('show');});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(btn,pane){document.querySelectorAll('.ctab').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));btn.classList.add('active');document.getElementById(pane).classList.add('active');if(pane==='tab-mindmap'&&mmData)setTimeout(renderMindMap,50);}
function setRtype(btn){document.querySelectorAll('.rtype').forEach(b=>b.classList.remove('active'));btn.classList.add('active');}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2400);}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
</script>
</body>
</html>
